<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>10 Linear Models | Using R for ecological modeling in USACE</title>
<meta name="author" content="Ed Stowe">
<meta name="generator" content="bookdown 0.42 with bs4_book()">
<meta property="og:title" content="10 Linear Models | Using R for ecological modeling in USACE">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="10 Linear Models | Using R for ecological modeling in USACE">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="This module will teach you how to use linear models in R to assess relationships among environmental factors in the USACE-managed Upper Mississippi River. Linear model results showing the...">
<meta property="og:description" content="This module will teach you how to use linear models in R to assess relationships among environmental factors in the USACE-managed Upper Mississippi River. Linear model results showing the...">
<meta name="twitter:description" content="This module will teach you how to use linear models in R to assess relationships among environmental factors in the USACE-managed Upper Mississippi River. Linear model results showing the...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Using R for ecological modeling in USACE</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="required-set-up-for-the-course.html">Required set-up for the course</a></li>
<li class="book-part">Basic Training on R and RStudio</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="data-visualization-with-ggplot2.html"><span class="header-section-number">2</span> Data Visualization with ggplot2</a></li>
<li><a class="" href="exploring-and-understanding-data.html"><span class="header-section-number">3</span> Exploring and understanding data</a></li>
<li><a class="" href="manipulating-tabular-data.html"><span class="header-section-number">4</span> Manipulating Tabular Data</a></li>
<li class="book-part">Ecological Modeling in R</li>
<li><a class="" href="conceptual-ecological-models.html"><span class="header-section-number">5</span> Conceptual Ecological Models</a></li>
<li class="book-part">Habitat Models</li>
<li><a class="" href="background-on-habitat-models-in-usace.html"><span class="header-section-number">6</span> Background on habitat models in USACE</a></li>
<li><a class="" href="habitat-suitability-index-models-with-ecorest.html"><span class="header-section-number">7</span> Habitat Suitability Index models with ecorest</a></li>
<li><a class="" href="ecorest-web-app.html"><span class="header-section-number">8</span> Ecorest Web App</a></li>
<li><a class="" href="spatial-habitat-models.html"><span class="header-section-number">9</span> Spatial Habitat Models</a></li>
<li class="book-part">Linear Models</li>
<li><a class="active" href="linear-models.html"><span class="header-section-number">10</span> Linear Models</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">11</span> Generalized Linear Models</a></li>
<li><a class="" href="random-effects.html"><span class="header-section-number">12</span> Random Effects</a></li>
<li class="book-part">Machine Learning</li>
<li><a class="" href="random-forest.html"><span class="header-section-number">13</span> Random Forest</a></li>
<li><a class="" href="boosted-regression-trees.html"><span class="header-section-number">14</span> Boosted Regression Trees</a></li>
<li><a class="" href="population-modeling.html"><span class="header-section-number">15</span> Population Modeling</a></li>
<li><a class="" href="network-models-and-connectivity.html"><span class="header-section-number">16</span> Network Models and Connectivity</a></li>
<li><a class="" href="agent-based-models.html"><span class="header-section-number">17</span> Agent-based Models</a></li>
<li class="book-part">Models and decisionmaking</li>
<li><a class="" href="decision-support.html"><span class="header-section-number">18</span> Decision Support</a></li>
<li><a class="" href="cost-effectiveness-and-incremental-cost-analysis-ceica-with-ecorest.html"><span class="header-section-number">19</span> Cost-Effectiveness and Incremental Cost Analysis (CEICA) with ecorest</a></li>
<li><a class="" href="annualizing-benefits-and-costs.html"><span class="header-section-number">20</span> Annualizing benefits and costs</a></li>
<li class="book-part">Other R applications</li>
<li><a class="" href="spatial-data-manipulation.html"><span class="header-section-number">21</span> Spatial Data Manipulation</a></li>
<li><a class="" href="important-data-sources.html"><span class="header-section-number">22</span> Important data sources</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="linear-models" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Linear Models<a class="anchor" aria-label="anchor" href="#linear-models"><i class="fas fa-link"></i></a>
</h1>
<p><strong>This module will teach you how to use linear models in R to assess relationships among environmental factors in the USACE-managed Upper Mississippi River.</strong></p>
<div class="float">
<img src="images/ancova_plot.png" style="width:100.0%" alt="Linear model results showing the relationship betwee temperature, vegetation density, and dissolved oxygen in the Upper Mississippi River."><div class="figcaption"><em>Linear model results showing the relationship betwee temperature, vegetation density, and dissolved oxygen in the Upper Mississippi River.</em></div>
</div>
<p><em>Authors: Ed Stowe</em><br><em>Last update: 2025-01-31</em><br><em>Acknowledgements: Some inspiration/language/code have been used or adapted with permission from: Ben Staton’s <a href="https://bstaton1.github.io/au-r-workshop/ch3.html#lm">Intro to R for Natural Resources course</a> Quebec Center for biodiversity Science’s <a href="https://r.qcbs.ca/workshop04/book-en/index.html">Linear model workshop</a></em></p>
<div id="relevance-of-linear-models-to-usace" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Relevance of linear models to USACE<a class="anchor" aria-label="anchor" href="#relevance-of-linear-models-to-usace"><i class="fas fa-link"></i></a>
</h2>
<p>Linear models and their offshoots estimate the relationship between a response variable and one or more predictor variables. These models are used widely by ecologists to understand, for example, which environmental or management factors are important for determining biological outcomes or phenomena. Linear models have several potential applications to USACE projects or ecological modeling practices:</p>
<ul>
<li>Validating and updating relationships within existing HSI models</li>
<li>Creating new habitat models that are based on empirical data instead of conjecture</li>
<li>Estimating the relationship between focal taxa and habitat characteristics in order to predict the response of these species to USACE habitat-altering projects (thus potentially acting as an alternative to a habitat model)</li>
</ul>
</div>
<div id="learning-objectives-5" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Learning objectives<a class="anchor" aria-label="anchor" href="#learning-objectives-5"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Understand the purpose and structure of a linear model</li>
<li>Run a linear model in R</li>
<li>Interpret the output of a linear model</li>
<li>Assess linear model validity</li>
</ul>
</div>
<div id="background-on-linear-models" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Background on linear models<a class="anchor" aria-label="anchor" href="#background-on-linear-models"><i class="fas fa-link"></i></a>
</h2>
<p>Linear models are used to estimate the relationship (if any) between a response variable and one or more predictor variable(s). They are typically constructed to analyze an a priori hypothesis about how variables are correlated. The results of the analysis indicate the direction and strength of the relationship between the variables, and what level of confidence we have in this relationship.</p>
<div id="linear-model-formulation" class="section level3" number="10.3.1">
<h3>
<span class="header-section-number">10.3.1</span> Linear model formulation<a class="anchor" aria-label="anchor" href="#linear-model-formulation"><i class="fas fa-link"></i></a>
</h3>
<p>In a linear model, the response variable is the variable that we wish to explain, and is also known as the dependent variable, because its value may depend on the values of the predictor variables. There is only one response variable. Predictor variables (also known as independent or explanatory variables), on the other hand, are variables with the potential to explain or predict the response variable. Linear models can have multiple predictor variables.</p>
<p>In a linear model, a single observation of the response variable <span class="math inline">\(y\)</span> is defined as <span class="math inline">\(y_i\)</span>, where as the corresponding observation of the predictor variable <span class="math inline">\(x\)</span> is defined as <span class="math inline">\(x_i\)</span>. The values of <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> are related to each other using the below formula, which describes the relationship between the two variables as a straight line:</p>
<p><span class="math display">\[ y_i = \beta_0 + \beta_1 \times x_i + \epsilon_i\]</span></p>
<ul>
<li>
<span class="math inline">\(y_i\)</span> is the response variable</li>
<li>
<span class="math inline">\(x_i\)</span> is the predictor</li>
<li>The parameter <span class="math inline">\(\beta_0\)</span> is the <strong>intercept</strong>
</li>
<li>The parameter <span class="math inline">\(\beta_1\)</span> quantifies the effect** of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span>
</li>
<li>The residual <span class="math inline">\(\epsilon_i\)</span> represents the <strong>unexplained</strong> variation</li>
</ul>
<p>Basically, this is just a reformulation of a classic middle school equation used to graph a straight line–<span class="math inline">\(y = mx + b\)</span>–only in this case <span class="math inline">\(\beta_1\)</span> stands in for <span class="math inline">\(m\)</span> and <span class="math inline">\(\beta_0\)</span> for <span class="math inline">\(b\)</span>. Here, we also inherently have the idea that the explanatory variables will never explain all of the variation in the predictor: what’s left over is the model error <span class="math inline">\(\epsilon_i\)</span>, also knows as the residuals.</p>
<p>Remember, the main purpose of fitting a linear model is to estimate the coefficient values (<span class="math inline">\(\beta\)</span>); doing so provides insight into the magnitude and direction of the relationship between the predictors and the response variables. We are also interested in how much of the variation in our response variable is explained by our predictor variables</p>
</div>
<div id="linear-model-assumptions" class="section level3" number="10.3.2">
<h3>
<span class="header-section-number">10.3.2</span> Linear model assumptions<a class="anchor" aria-label="anchor" href="#linear-model-assumptions"><i class="fas fa-link"></i></a>
</h3>
<p>Linear models have some important assumptions. The statistician Andrew Gelman lists the <a href="https://statmodeling.stat.columbia.edu/2013/08/04/19470/">most important linear model assumptions</a>, in order of importance, as follows:</p>
<ul>
<li>Validity: the response and predictors should pertain directly to the research question.</li>
<li>Additivity and linearity: the response variable of the model should be a linear function of the separate predictors.<br>
</li>
<li>Independence of errors: the value of one residual should be completely independent from the value of adjacent residuals.</li>
<li>Equal variance of errors: there should not be greater variance for some values of the predictor than others.<br>
</li>
<li>Normality of errors: the residuals taken together should be distributed normally.</li>
</ul>
<p>The last three assumptions listed here have to do with the model residuals. Remember, these are the model error and represent the difference between the data point <span class="math inline">\(y_i\)</span> and the model prediction <span class="math inline">\(\hat{y}_i\)</span>. The figure below indicates a model where the residuals meet these assumptions.</p>
<div class="float">
<img src="images/residuals_janhove.png" style="width:100.0%" alt="Graphical depiction of linear modeling assumptions from Jan Vanhove"><div class="figcaption"><em>Graphical depiction of linear modeling assumptions from Jan Vanhove</em></div>
</div>
<p>So, how should one think about these assumptions and when they are violated? Well, academic <a href="https://janhove.github.io/posts/2019-04-11-assumptions-relevance/">Jan Vanhove</a> has a helpful way of thinking about them: when assumptions are violated, model inferences shouldn’t necessarily be thought of as incorrect, but rather as less relevant.</p>
</div>
</div>
<div id="application-of-a-linear-model" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Application of a linear model<a class="anchor" aria-label="anchor" href="#application-of-a-linear-model"><i class="fas fa-link"></i></a>
</h2>
<p>To demonstrate linear modeling in practice, we’ll use data from USACE’s Upper Mississippi River Restoration Program’s <a href="https://umesc.usgs.gov/ltrmp/about_us_background.html">Long Term Resource Monitoring Program</a>. The data we’ve collated from this source contains fisheries catch data and corresponding environmental conditions. We may be interested broadly in understanding which environmental conditions–depth, current, etc.–determine aspects of fish communities. However, before throwing several variables in a model to predict drivers of, say, fish abundance, we should assess whether there are any correlations or dependencies among environmental variables. We need to do this to avoid mistaking the effect of one predictor for another.</p>
<p>For example, in aquatic systems, there is often a relationship between water temperature and dissolved oxygen: the solubility of oxygen in water decreases as temperature increases, meaning that colder water is frequently more oxygenated. However, dissolved oxygen levels may also be affected by aquatic plants, or water turbulence that can introduce oxygen to the water surface. Understanding these dependencies may be important for our ultimate goal of understanding what factors affect fish communities. To do so, we will use linear models in R.</p>
<div id="import-and-explore-the-data" class="section level3" number="10.4.1">
<h3>
<span class="header-section-number">10.4.1</span> Import and explore the data<a class="anchor" aria-label="anchor" href="#import-and-explore-the-data"><i class="fas fa-link"></i></a>
</h3>
<p>First, we will read in a subset of the fish and environmental data from fall sampling in navigation pools, 4, 8, and 13 of the Upper Mississippi River. We filter the data to remove dissolved oxygen values &gt; 20 mg/L, since values above these levels may be erroneous.</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">umr_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/umr_counts_wide.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">umr_sub</span> <span class="op">&lt;-</span> <span class="va">umr_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">do</span> <span class="op">&lt;</span> <span class="fl">20</span>, </span>
<span>         <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">vegd</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can use ggplot to plot the relationship between dissolved oxygen and temperature. We can also add a line for these predictors; here we specify that we want the line to be linear by adding the call <code>method = "lm"</code>.</p>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">umr_sub</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">do</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, pch <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Temperature (C)"</span>, y <span class="op">=</span> <span class="st">"Dissolved Oxygen"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="usace_R_training_files/figure-html/unnamed-chunk-28-1.png" width="600" height="600"></div>
<p>We can see that there’s a pretty clear relationship between these two variables. But we’d like to go beyond this to quantify this relationship statistically.</p>
</div>
<div id="fit-a-model-and-assess-output" class="section level3" number="10.4.2">
<h3>
<span class="header-section-number">10.4.2</span> Fit a model and assess output<a class="anchor" aria-label="anchor" href="#fit-a-model-and-assess-output"><i class="fas fa-link"></i></a>
</h3>
<p>We can now use the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function in r to create a linear model further assessing the relationship between these variables. To use the lm() function, we provide R with the formula for our model. The formula that we include below (<code>do ~ temp</code>) indicates that we are interested in modeling <code>do</code> as a function of <code>temp</code>. In other words, we are telling R that dissolved oxygen is our response variable, and temperature is our predictor variable. If we wanted to add another predictor we would change the formula (e.g., <code>do ~ temp + depth</code> or <code>do ~ temp*detph</code> if we wanted an interactive effective). We also have indicate what dataset to use.</p>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">do</span> <span class="op">~</span> <span class="va">temp</span>,</span>
<span>           data <span class="op">=</span> <span class="va">umr_sub</span><span class="op">)</span></span></code></pre></div>
<p>That’s all we have to do to fit our first model, which is now stored in the <code>lm.mod</code> object.</p>
<p>We use the <code>summary</code> function to assess the model results.</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_summ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm.mod</span><span class="op">)</span></span>
<span><span class="va">mod_summ</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = do ~ temp, data = umr_sub)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.1881 -1.1783 -0.0571  1.0723 10.5807 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 12.64919    0.19403   65.19   &lt;2e-16 ***
## temp        -0.25855    0.01161  -22.27   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.295 on 2570 degrees of freedom
## Multiple R-squared:  0.1617, Adjusted R-squared:  0.1614 
## F-statistic: 495.8 on 1 and 2570 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The output of the <code>summary</code> function contains important information about:</p>
<ol style="list-style-type: decimal">
<li>
<code>Coefficients</code>: Estimates of the parameters and their standard deviation</li>
<li>
<code>Pr(&gt;|t|)</code>: Results of a t-test to determine if the parameters are different from 0</li>
<li>
<code>Adjusted R squared</code>: How well does the model explain the data?</li>
<li>
<code>F-statistic</code>(ANOVA): Is the model significantly different from a model with no predictor (null model)?</li>
</ol>
<p>Taken together, these values can be used to assess the extent to which temperature predicts dissolved oxygen in our study location. We can first look at the estimate for our <span class="math inline">\(\beta_1\)</span> coefficient <code>temp</code>, which indicates the effect size of temperature on dissolved oxygen, here with an approximate value of -0.26. This means that on average, for every 1 degree C increase in temperature, the dissolved oxygen decreases by -0.26 mg/L. This represents a moderately substantial relationship. We also get an estimate of the intercept, which is our <span class="math inline">\(\beta_0\)</span> coefficient. This suggests that we would predict a dissolved oxygen level of 12.6 mg/L when temperature is 0 degrees.</p>
<p>We can also see from the <code>Adjusted R-squared</code> estimate of 0.16 that our model explains about 16% of the variance in the dissolved oxygen. In ecological research this a decent amount of the variance. But we may still wish to refine our model so that it does a better job of explaining this variance.</p>
</div>
<div id="assess-model-validity" class="section level3" number="10.4.3">
<h3>
<span class="header-section-number">10.4.3</span> Assess model validity<a class="anchor" aria-label="anchor" href="#assess-model-validity"><i class="fas fa-link"></i></a>
</h3>
<p>But can we trust these results? We first need to verify that the model assumptions have been met, and examining the residuals turns out to be the key for assessing if a linear model is the appropriate choice for modeling data. We can do by making diagnostic plots of the residuals using the <code>plot(lm.mod)</code> function. Running this function will create four plots sequentially in R, but we will examine them individually with the following code. See a very detailed explanation of these plots <a href="https://r.qcbs.ca/workshop04/book-en/linear-regression-in-r.html#step-2-verify-assumptions-using-diagnostic-plots-of-the-residuals">here</a>.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm.mod</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="usace_R_training_files/figure-html/unnamed-chunk-31-1.png" width="600" height="600"></div>
<p>The first plot shows the <strong>Residuals vs. the Fitted values</strong>. Remember, the residuals are the difference between predicted values of the response variable (dissolved oxygen here) and observed values of the response variable. If the model assumptions are met, this plot should have a horizontal line with residuals spread around it fairly evenly. If the residuals show non-linear patterns (e.g., a parabola) it may indicate a non-linear relationship between our predictors and our response variable. Here there appears to be fairly random scatter of residuals, suggesting no major problems with non-linearity.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm.mod</span>, which <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="usace_R_training_files/figure-html/unnamed-chunk-32-1.png" width="600" height="600"></div>
<p>The <strong>Q-Q residual plot</strong> is used to assess whether the residuals follow a <strong>normal distribution</strong>; the points in the plot should closely follow the diagonal line. In our example, the residuals deviate a bit in the tails, suggesting that the residuals may not be perfectly distributed, but normality of residuals is not very critical with large datasets like this and is considered to be one of the less important linear model assumptions.</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm.mod</span>, which <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="usace_R_training_files/figure-html/unnamed-chunk-33-1.png" width="600" height="600"></div>
<p>The <strong>Scale-Location plot</strong> checks for <strong>constant variance of residuals</strong>. Similar to the first plot, the red line should be roughly flat, and there shouldn’t be any systematic spread in the data. Our model again does fairly well here, although there is a slight increase in variance with higher fitted values.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm.mod</span>, which <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="usace_R_training_files/figure-html/unnamed-chunk-34-1.png" width="600" height="600"></div>
<p>Finally the <strong>Residuals vs. Leverage plot</strong> indicate whether there are any <strong>influential outliers</strong> that can bias results. In this plot, we specifically look for any large points in the upper or lower right: these are points with large residuals and high leverage. Depending on the spread of the residuals, there may be some dashed lines in these points called “Cook’s distance” scores. Points outside these dashed lines, they may have a strong influence on the regression results, suggesting that parameter estimates might be biased.</p>
<p>Taken together, these plots suggest that a linear model is a reasonable choice for assessing the relationship between temperature and dissolved oxygen. Had our model violated the linear model assumptions more egregiously, we would need to use a different model type, often a generalized linear model, covered in the subsequent module.</p>
</div>
<div id="ancova" class="section level3" number="10.4.4">
<h3>
<span class="header-section-number">10.4.4</span> ANCOVA<a class="anchor" aria-label="anchor" href="#ancova"><i class="fas fa-link"></i></a>
</h3>
<p>Even if a linear model is reasonable in our case, we may hope to explain more of the variance. We alluded to the possibility that other variables may be important. What about submersed aquatic vegetation that could be pumping oxygen into the water column? Our dataset contains a categorical variable for density of vegetation <code>vegd</code> which is 1 when vegetation is sparse and 2 when vegetation is dense. Categorical variables can be added to linear models in R, although we need to make sure that they are coded as factors, not as numeric variables.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">umr_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">umr_sub</span>, </span>
<span>                  vegd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">vegd</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If a model only has categorical variables, it is an ANOVA. When a categorical variable is used in concert with a continuous variable, known as an ANCOVA, it is the equivalent of fitting two regression lines within the same model; these lines will be parallel but have different intercepts. The difference in intercepts represents the average effect of the categorical variable on the response.</p>
<p>We can start to look at the possibility of an influence of vegetation by first plotting our data again, but this time coloring our points in ggplot differentially (i.e., adding <code>color = vegd</code> to our earlier code):</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">umr_sub</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">do</span>, color <span class="op">=</span> <span class="va">vegd</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, pch <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Temperature (C)"</span>, y <span class="op">=</span> <span class="st">"Dissolved Oxygen (mg/L)"</span>, color <span class="op">=</span> <span class="st">"Veg.\ndensity"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure">
<img src="usace_R_training_files/figure-html/unnamed-chunk-36-1.png" width="600" height="600">
Somewhat surprisingly, when we plot this, we see the possibility that sampling location with sparser vegetation tend to have higher dissolved oxygen concentrations, not higher dissolved oxygen as we might have expected.</div>
<p>To assess the magnitude of this effect, we run a new linear model that includes both our continuous temperature predictor and our categorical vegetation predictor.</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ancov.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">do</span> <span class="op">~</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">vegd</span>, </span>
<span>                data <span class="op">=</span> <span class="va">umr_sub</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ancov.mod</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = do ~ temp + vegd, data = umr_sub)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.8610 -1.1965 -0.1168  1.0716 10.8873 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 12.78663    0.19367  66.021  &lt; 2e-16 ***
## temp        -0.24924    0.01161 -21.469  &lt; 2e-16 ***
## vegd2       -0.58551    0.09052  -6.468 1.18e-10 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.277 on 2569 degrees of freedom
## Multiple R-squared:  0.1752, Adjusted R-squared:  0.1745 
## F-statistic: 272.8 on 2 and 2569 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The summary shows a coefficient for <code>vegd2</code> of -0.59. This means that on average, locations with the same temperature will have about 0.6 mg/L less oxygen if dense vegetation is present (i.e., where <code>vegd</code> equals 2) compared to sparse vegetation. Note, that there is only a coefficient for one level of the vegetation variable (i.e., where <code>vegd</code> equals 2, not where <code>vegd</code> equals 1). That is because one level of a categorical variable (here, where <code>vegd</code> equals 1) is always used as the reference level, and the coefficients reported represent the difference in the response variable between each level and the baseline level. Beyond coefficients, we can see that R-squared increased but only marginally: adding <code>vegd</code> to the model only increased our explanation of the variance in the response data by 1.5%.</p>
<p>In a real analysis, we might try some data transformations to improve model fit, and/or explore other variables for potential model inclusion. Finally, we might assess which model is best using a <a href="https://bstaton1.github.io/au-r-workshop/ch3.html#aic-model-selection">model selection approach like AIC</a>. For in-depth coverage of some of these topics, we point the user to the following sources:</p>
<ul>
<li>Quebec Center for biodiversity Science’s <a href="https://r.qcbs.ca/workshop04/book-en/index.html">Linear model workshop</a><br>
</li>
<li>Ben Staton’s <a href="https://bstaton1.github.io/au-r-workshop/ch3.html#lm">Intro to R for Natural Resources course</a>
</li>
</ul>
</div>
</div>
<div id="summary" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Summary<a class="anchor" aria-label="anchor" href="#summary"><i class="fas fa-link"></i></a>
</h2>
<p>Here we saw that linear models can be used to describe the linear relationship between a response variable and some number of predictor variables. The best linear models should be thought of as means to assess hypotheses that have been developed based on some subject matter expertise. And the results of the linear model will indicate whether the data support that hypothesis, by giving us estimates of the magnitude and direction of our effect sizes, how much variability the model explains and how much uncertainy there is.</p>
<p>Linear models are best under fairly constrained scenarios i.e., when response data are continuous variables, when there is a linear relationship between variables, etc. However, in ecological research, many data types–especially binary and count data–rarely if ever meet these criteria, and other model types are required. For example the next module presents an extension of linear models that can be used for ubiquitous data types like counts or binary data that do not conform to the assumptions of linear models.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="spatial-habitat-models.html"><span class="header-section-number">9</span> Spatial Habitat Models</a></div>
<div class="next"><a href="generalized-linear-models.html"><span class="header-section-number">11</span> Generalized Linear Models</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#linear-models"><span class="header-section-number">10</span> Linear Models</a></li>
<li><a class="nav-link" href="#relevance-of-linear-models-to-usace"><span class="header-section-number">10.1</span> Relevance of linear models to USACE</a></li>
<li><a class="nav-link" href="#learning-objectives-5"><span class="header-section-number">10.2</span> Learning objectives</a></li>
<li>
<a class="nav-link" href="#background-on-linear-models"><span class="header-section-number">10.3</span> Background on linear models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#linear-model-formulation"><span class="header-section-number">10.3.1</span> Linear model formulation</a></li>
<li><a class="nav-link" href="#linear-model-assumptions"><span class="header-section-number">10.3.2</span> Linear model assumptions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#application-of-a-linear-model"><span class="header-section-number">10.4</span> Application of a linear model</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#import-and-explore-the-data"><span class="header-section-number">10.4.1</span> Import and explore the data</a></li>
<li><a class="nav-link" href="#fit-a-model-and-assess-output"><span class="header-section-number">10.4.2</span> Fit a model and assess output</a></li>
<li><a class="nav-link" href="#assess-model-validity"><span class="header-section-number">10.4.3</span> Assess model validity</a></li>
<li><a class="nav-link" href="#ancova"><span class="header-section-number">10.4.4</span> ANCOVA</a></li>
</ul>
</li>
<li><a class="nav-link" href="#summary"><span class="header-section-number">10.5</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Using R for ecological modeling in USACE</strong>" was written by Ed Stowe. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
