<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4 Manipulating Tabular Data | Using R for ecological modeling in USACE</title>
<meta name="author" content="Ed Stowe">
<meta name="generator" content="bookdown 0.42 with bs4_book()">
<meta property="og:title" content="4 Manipulating Tabular Data | Using R for ecological modeling in USACE">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4 Manipulating Tabular Data | Using R for ecological modeling in USACE">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="Authors: Data Carpentry contributors - Copyright (c) Data Carpentry; Ed Stowe (adaptation for USACE); Brian Breaker (for loop and function code)Last update: 2025-02-12Acknowledgements: The bulk of...">
<meta property="og:description" content="Authors: Data Carpentry contributors - Copyright (c) Data Carpentry; Ed Stowe (adaptation for USACE); Brian Breaker (for loop and function code)Last update: 2025-02-12Acknowledgements: The bulk of...">
<meta name="twitter:description" content="Authors: Data Carpentry contributors - Copyright (c) Data Carpentry; Ed Stowe (adaptation for USACE); Brian Breaker (for loop and function code)Last update: 2025-02-12Acknowledgements: The bulk of...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Using R for ecological modeling in USACE</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Course overview</a></li>
<li><a class="" href="required-set-up-for-the-course.html">Required set-up for the course</a></li>
<li class="book-part">Basic Training on R and RStudio</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="data-visualization-with-ggplot2.html"><span class="header-section-number">2</span> Data Visualization with ggplot2</a></li>
<li><a class="" href="exploring-and-understanding-data.html"><span class="header-section-number">3</span> Exploring and understanding data</a></li>
<li><a class="active" href="manipulating-tabular-data.html"><span class="header-section-number">4</span> Manipulating Tabular Data</a></li>
<li class="book-part">Ecological Modeling in R</li>
<li><a class="" href="conceptual-ecological-models.html"><span class="header-section-number">5</span> Conceptual Ecological Models</a></li>
<li class="book-part">Habitat Models</li>
<li><a class="" href="background-on-habitat-models-in-usace.html"><span class="header-section-number">6</span> Background on habitat models in USACE</a></li>
<li><a class="" href="habitat-suitability-index-models-with-ecorest.html"><span class="header-section-number">7</span> Habitat Suitability Index models with ecorest</a></li>
<li><a class="" href="ecorest-web-app.html"><span class="header-section-number">8</span> Ecorest Web App</a></li>
<li><a class="" href="sensitivity-and-uncertainty-analysis-for-habitat-suitability-index-hsi-models.html"><span class="header-section-number">9</span> Sensitivity and uncertainty analysis for habitat suitability index (HSI) models</a></li>
<li><a class="" href="spatial-habitat-models.html"><span class="header-section-number">10</span> Spatial Habitat Models</a></li>
<li class="book-part">Linear Models for informing planning HSIs</li>
<li><a class="" href="linear-models.html"><span class="header-section-number">11</span> Linear Models</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">12</span> Generalized Linear Models</a></li>
<li><a class="" href="random-effects.html"><span class="header-section-number">13</span> Random Effects</a></li>
<li><a class="" href="generalized-additive-models.html"><span class="header-section-number">14</span> Generalized Additive Models</a></li>
<li class="book-part">Machine Learning</li>
<li><a class="" href="random-forest.html"><span class="header-section-number">15</span> Random Forest</a></li>
<li><a class="" href="boosted-regression-trees.html"><span class="header-section-number">16</span> Boosted Regression Trees</a></li>
<li class="book-part">Other Modeling Approaches</li>
<li><a class="" href="population-modeling.html"><span class="header-section-number">17</span> Population Modeling</a></li>
<li><a class="" href="network-models-and-connectivity.html"><span class="header-section-number">18</span> Network Models and Connectivity</a></li>
<li><a class="" href="agent-based-models.html"><span class="header-section-number">19</span> Agent-based Models</a></li>
<li class="book-part">Models and decision-making</li>
<li><a class="" href="decision-support.html"><span class="header-section-number">20</span> Decision Support</a></li>
<li><a class="" href="annualizing-benefits-and-costs-with-ecorest-and-engrecon.html"><span class="header-section-number">21</span> Annualizing benefits and costs with ecorest and EngrEcon</a></li>
<li><a class="" href="ceica-chapter.html"><span class="header-section-number">22</span> Cost-Effectiveness and Incremental Cost Analysis (CEICA) with ecorest</a></li>
<li class="book-part">Models Integration</li>
<li><a class="" href="model-integration.html"><span class="header-section-number">23</span> Model Integration</a></li>
<li class="book-part">Other R applications</li>
<li><a class="" href="r-for-gis.html"><span class="header-section-number">24</span> R for GIS</a></li>
<li class="book-part">Environmental data sources</li>
<li><a class="" href="using-r-for-data-access.html"><span class="header-section-number">25</span> Using R for data access</a></li>
<li><a class="" href="usgs-gage-data-using-the-dataretrieval-package.html"><span class="header-section-number">26</span> USGS gage data using the dataRetrieval package</a></li>
<li><a class="" href="national-hydrography-dataset.html"><span class="header-section-number">27</span> National Hydrography Dataset</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="manipulating-tabular-data" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Manipulating Tabular Data<a class="anchor" aria-label="anchor" href="#manipulating-tabular-data"><i class="fas fa-link"></i></a>
</h1>
<p><em>Authors: Data Carpentry contributors - Copyright (c) Data Carpentry; Ed Stowe (adaptation for USACE); Brian Breaker (for loop and function code)</em><br><em>Last update: 2025-02-12</em><br><em>Acknowledgements: The bulk of this <a href="https://datacarpentry.github.io/R-ecology-lesson/introduction-r-rstudio.html">section</a> is adapted from the <a href="https://datacarpentry.org">Data Carpentry</a> course <a href="https://datacarpentry.github.io/R-ecology-lesson/">Data Analysis and Visualization in R for Ecologists</a> which is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> by the authors</em></p>
<div id="learning-objectives-4" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Learning Objectives<a class="anchor" aria-label="anchor" href="#learning-objectives-4"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Import CSV data into R.</li>
<li>Understand the difference between base R and <code>tidyverse</code> approaches.</li>
<li>Subset rows and columns of data.frames.</li>
<li>Use pipes to link steps together into pipelines.</li>
<li>Create new data.frame columns using existing columns.</li>
<li>Utilize the concept of split-apply-combine data analysis.</li>
<li>Reshape data between wide and long formats.</li>
<li>Export data to a CSV file.</li>
</ul>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div id="importing-data" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Importing data<a class="anchor" aria-label="anchor" href="#importing-data"><i class="fas fa-link"></i></a>
</h2>
<p>Up until this point, we have been working with the <code>complete_old</code> dataframe contained in the <code>ratdat</code> package. However, you typically won’t access data from an R package; it is much more common to access data files stored somewhere on your computer. We are going to download a CSV file containing the surveys data to our computer, which we will then read into R.</p>
<p>Click this link to download the file: <a href="https://datacarpentry.org/R-ecology-lesson/data/cleaned/surveys_complete_77_89.csv" class="uri">https://datacarpentry.org/R-ecology-lesson/data/cleaned/surveys_complete_77_89.csv</a>.</p>
<p>You will be prompted to save the file on your computer somewhere. Save it inside the <code>cleaned</code> data folder, which is in the <code>data</code> folder in your <code>R-Ecology-Workshop</code> folder. Once it’s inside our project, we will be able to point R towards it.</p>
<div id="file-paths" class="section level4" number="4.2.0.1">
<h4>
<span class="header-section-number">4.2.0.1</span> File paths<a class="anchor" aria-label="anchor" href="#file-paths"><i class="fas fa-link"></i></a>
</h4>
<p>When we reference other files from an R script, we need to give R precise instructions on where those files are. We do that using something called a <strong>file path</strong>. It looks something like this: <code>"Documents/Manuscripts/Chapter_2.txt"</code>. This path would tell your computer how to get from whatever folder contains the <code>Documents</code> folder all the way to the <code>.txt</code> file.</p>
<p>There are two kinds of paths: <strong>absolute</strong> and <strong>relative</strong>. Absolute paths are specific to a particular computer, whereas relative paths are relative to a certain folder. Because we are keeping all of our work in the <code>R-Ecology-Workshop</code> folder, all of our paths can be relative to this folder.</p>
<p>Now, let’s read our CSV file into R and store it in an object named <code>surveys</code>. We will use the <code>read_csv</code> function from the <code>tidyverse</code>’s <code>readr</code> package, and the argument we give will be the <strong>relative path</strong> to the CSV file.</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/surveys_complete_77_89.csv"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Rows: 16878 Columns: 13
## ── Column specification ─────────────────────────────────────────────────────
## Delimiter: ","
## chr (6): species_id, sex, genus, species, taxa, plot_type
## dbl (7): record_id, month, day, year, plot_id, hindfoot_length, weight
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="callout">
<p>Typing out paths can be error prone, so we can utilize a keyboard shortcut. Inside the parentheses of <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code>, type out a pair of quotes and put your cursor between them. Then hit <kbd>Tab</kbd>. A small menu showing your folders and files should show up. You can use the <kbd>↑</kbd> and <kbd>↓</kbd> keys to move through the options, or start typing to narrow them down. You can hit <kbd>Enter</kbd> to select a file or folder, and hit <kbd>Tab</kbd> again to continue building the file path. This might take a bit of getting used to, but once you get the hang of it, it will speed up writing file paths and reduce the number of mistakes you make.</p>
</div>
<p>You may have noticed a bit of feedback from R when you ran the last line of code. We got some useful information about the CSV file we read in. We can see:</p>
<ul>
<li>the number of rows and columns</li>
<li>the <strong>delimiter</strong> of the file, which is how values are separated, a comma <code>","</code>
</li>
<li>a set of columns that were <strong>parsed</strong> as various vector types
<ul>
<li>the file has 6 character columns and 7 numeric columns</li>
<li>we can see the names of the columns for each type</li>
</ul>
</li>
</ul>
<p>When working with the output of a new function, it’s often a good idea to check the <code><a href="https://rdrr.io/r/base/class.html">class()</a></code>:</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame"</code></pre>
<p>Whoa! What is this thing? It has multiple classes? Well, it’s called a <code>tibble</code>, and it is the <code>tidyverse</code> version of a data.frame. It <em>is</em> a data.frame, but with some added perks. It prints out a little more nicely, it highlights <code>NA</code> values and negative values in red, and it will generally communicate with you more (in terms of warnings and errors, which is a good thing).</p>
<div class="callout">
<p><strong><code>tidyverse</code> vs. base R</strong></p>
<p>As we begin to delve more deeply into the <code>tidyverse</code>, we should briefly pause to mention some of the reasons for focusing on the <code>tidyverse</code> set of tools. In R, there are often many ways to get a job done, and there are other approaches that can accomplish tasks similar to the <code>tidyverse</code>.</p>
<p>The phrase <strong>base R</strong> is used to refer to approaches that utilize functions contained in R’s default packages. We have already used some base R functions, such as <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>, <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code>, and <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, and we will be using more scattered throughout this lesson. However, there are some key base R approaches we will not be teaching. These include square bracket subsetting and base plotting. You may come across code written by other people that looks like <code>surveys[1:10, 2]</code> or <code>plot(surveys$weight, surveys$hindfoot_length)</code>, which are base R commands. If you’re interested in learning more about these approaches, you can check out other Carpentries lessons like the <a href="https://swcarpentry.github.io/r-novice-inflammation/">Software Carpentry Programming with R</a> lesson.</p>
<p>We choose to teach the <code>tidyverse</code> set of packages because they share a similar syntax and philosophy, making them consistent and producing highly readable code. They are also very flexible and powerful, with a growing number of packages designed according to similar principles and to work well with the rest of the packages. The <code>tidyverse</code> packages tend to have very clear documentation and wide array of learning materials that tend to be written with novice users in mind. Finally, the <code>tidyverse</code> has only continued to grow, and has strong support from RStudio, which implies that these approaches will be relevant into the future.</p>
</div>
</div>
</div>
<div id="manipulating-data" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Manipulating data<a class="anchor" aria-label="anchor" href="#manipulating-data"><i class="fas fa-link"></i></a>
</h2>
<p>One of the most important skills for working with data in R is the ability to manipulate, modify, and reshape data. The <code>dplyr</code> and <code>tidyr</code> packages in the <code>tidyverse</code> provide a series of powerful functions for many common data manipulation tasks.</p>
<p>We’ll start off with two of the most commonly used <code>dplyr</code> functions: <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, which selects certain columns of a data.frame, and <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, which filters out rows according to certain criteria.</p>
<div class="callout">
<p>Between <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, it can be hard to remember which operates on columns and which operates on rows. <code>sele</code><strong><code>c</code></strong><code><a href="https://rdrr.io/r/base/t.html">t()</a></code> has a <strong>c</strong> for <strong>c</strong>olumns and <code>filte</code><strong><code>r</code></strong><code>()</code> has an <strong>r</strong> for <strong>r</strong>ows.</p>
</div>
<div id="select" class="section level4" number="4.3.0.1">
<h4>
<span class="header-section-number">4.3.0.1</span> <code>select()</code><a class="anchor" aria-label="anchor" href="#select"><i class="fas fa-link"></i></a>
</h4>
<p>To use the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function, the first argument is the name of the data.frame, and the rest of the arguments are <em>unquoted</em> names of the columns you want:</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="va">plot_id</span>, <span class="va">species_id</span>, <span class="va">hindfoot_length</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 3
##    plot_id species_id hindfoot_length
##      &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;
##  1       2 NL                      32
##  2       3 NL                      33
##  3       2 DM                      37
##  4       7 DM                      36
##  5       3 DM                      35
##  6       1 PF                      14
##  7       2 PE                      NA
##  8       1 DM                      37
##  9       1 DM                      34
## 10       6 PF                      20
## # ℹ 16,868 more rows</code></pre>
<p>The columns are arranged in the order we specified inside <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>.</p>
<p>To select all columns except specific columns, put a <code>-</code> in front of the column you want to exclude:</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="op">-</span><span class="va">record_id</span>, <span class="op">-</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 11
##    month   day plot_id species_id sex   hindfoot_length weight genus     species
##    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;  
##  1     7    16       2 NL         M                  32     NA Neotoma   albigu…
##  2     7    16       3 NL         M                  33     NA Neotoma   albigu…
##  3     7    16       2 DM         F                  37     NA Dipodomys merria…
##  4     7    16       7 DM         M                  36     NA Dipodomys merria…
##  5     7    16       3 DM         M                  35     NA Dipodomys merria…
##  6     7    16       1 PF         M                  14     NA Perognat… flavus 
##  7     7    16       2 PE         F                  NA     NA Peromysc… eremic…
##  8     7    16       1 DM         M                  37     NA Dipodomys merria…
##  9     7    16       1 DM         F                  34     NA Dipodomys merria…
## 10     7    16       6 PF         F                  20     NA Perognat… flavus 
## # ℹ 16,868 more rows
## # ℹ 2 more variables: taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> also works with numeric vectors for the order of the columns. To select the 3rd, 4th, 5th, and 10th columns, we could run the following code:</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 4
##      day  year plot_id genus      
##    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      
##  1    16  1977       2 Neotoma    
##  2    16  1977       3 Neotoma    
##  3    16  1977       2 Dipodomys  
##  4    16  1977       7 Dipodomys  
##  5    16  1977       3 Dipodomys  
##  6    16  1977       1 Perognathus
##  7    16  1977       2 Peromyscus 
##  8    16  1977       1 Dipodomys  
##  9    16  1977       1 Dipodomys  
## 10    16  1977       6 Perognathus
## # ℹ 16,868 more rows</code></pre>
<p>You should be careful when using this method, since you are being less explicit about which columns you want. However, it can be useful if you have a data.frame with many columns and you don’t want to type out too many names.</p>
<p>Finally, you can select columns based on whether they match a certain criteria by using the <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code> function. If we want all numeric columns, we can ask to <code>select</code> all the columns <code>where</code> the class <code>is numeric</code>:</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 7
##    record_id month   day  year plot_id hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1         1     7    16  1977       2              32     NA
##  2         2     7    16  1977       3              33     NA
##  3         3     7    16  1977       2              37     NA
##  4         4     7    16  1977       7              36     NA
##  5         5     7    16  1977       3              35     NA
##  6         6     7    16  1977       1              14     NA
##  7         7     7    16  1977       2              NA     NA
##  8         8     7    16  1977       1              37     NA
##  9         9     7    16  1977       1              34     NA
## 10        10     7    16  1977       6              20     NA
## # ℹ 16,868 more rows</code></pre>
<p>Instead of giving names or positions of columns, we instead pass the <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code> function with the name of another function inside it, in this case <code><a href="https://rdrr.io/r/base/numeric.html">is.numeric()</a></code>, and we get all the columns for which that function returns <code>TRUE</code>.</p>
<p>We can use this to select any columns that have any <code>NA</code> values in them:</p>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">anyNA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 7
##    species_id sex   hindfoot_length weight genus       species  taxa  
##    &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt; 
##  1 NL         M                  32     NA Neotoma     albigula Rodent
##  2 NL         M                  33     NA Neotoma     albigula Rodent
##  3 DM         F                  37     NA Dipodomys   merriami Rodent
##  4 DM         M                  36     NA Dipodomys   merriami Rodent
##  5 DM         M                  35     NA Dipodomys   merriami Rodent
##  6 PF         M                  14     NA Perognathus flavus   Rodent
##  7 PE         F                  NA     NA Peromyscus  eremicus Rodent
##  8 DM         M                  37     NA Dipodomys   merriami Rodent
##  9 DM         F                  34     NA Dipodomys   merriami Rodent
## 10 PF         F                  20     NA Perognathus flavus   Rodent
## # ℹ 16,868 more rows</code></pre>
</div>
<div id="filter" class="section level4" number="4.3.0.2">
<h4>
<span class="header-section-number">4.3.0.2</span> <code>filter()</code><a class="anchor" aria-label="anchor" href="#filter"><i class="fas fa-link"></i></a>
</h4>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function is used to select rows that meet certain criteria. To get all the rows where the value of <code>year</code> is equal to 1985, we would run the following:</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">1985</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1,438 × 13
##    record_id month   day  year plot_id species_id sex   hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1      9790     1    19  1985      16 RM         F                  16      4
##  2      9791     1    19  1985      17 OT         F                  20     16
##  3      9792     1    19  1985       6 DO         M                  35     48
##  4      9793     1    19  1985      12 DO         F                  35     40
##  5      9794     1    19  1985      24 RM         M                  16      4
##  6      9795     1    19  1985      12 DO         M                  34     48
##  7      9796     1    19  1985       6 DM         F                  37     35
##  8      9797     1    19  1985      14 DM         M                  36     45
##  9      9798     1    19  1985       6 DM         F                  36     38
## 10      9799     1    19  1985      19 RM         M                  16      4
## # ℹ 1,428 more rows
## # ℹ 4 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<p>The <code>==</code> sign means “is equal to”. There are several other operators we can use: &gt;, &gt;=, &lt;, &lt;=, and != (not equal to). Another useful operator is <code>%in%</code>, which asks if the value on the lefthand side is found anywhere in the vector on the righthand side. For example, to get rows with specific <code>species_id</code> values, we could run:</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="va">species_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"RM"</span>, <span class="st">"DO"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 2,835 × 13
##    record_id month   day  year plot_id species_id sex   hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1        68     8    19  1977       8 DO         F                  32     52
##  2       292    10    17  1977       3 DO         F                  36     33
##  3       294    10    17  1977       3 DO         F                  37     50
##  4       311    10    17  1977      19 RM         M                  18     13
##  5       317    10    17  1977      17 DO         F                  32     48
##  6       323    10    17  1977      17 DO         F                  33     31
##  7       337    10    18  1977       8 DO         F                  35     41
##  8       356    11    12  1977       1 DO         F                  32     44
##  9       378    11    12  1977       1 DO         M                  33     48
## 10       397    11    13  1977      17 RM         F                  16      7
## # ℹ 2,825 more rows
## # ℹ 4 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<p>We can also use multiple conditions in one <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> statement. Here we will get rows with a year less than or equal to 1988 and whose hindfoot length values are not <code>NA</code>. The <code>!</code> before the <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> function means “not”.</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">1988</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 12,779 × 13
##    record_id month   day  year plot_id species_id sex   hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1         1     7    16  1977       2 NL         M                  32     NA
##  2         2     7    16  1977       3 NL         M                  33     NA
##  3         3     7    16  1977       2 DM         F                  37     NA
##  4         4     7    16  1977       7 DM         M                  36     NA
##  5         5     7    16  1977       3 DM         M                  35     NA
##  6         6     7    16  1977       1 PF         M                  14     NA
##  7         8     7    16  1977       1 DM         M                  37     NA
##  8         9     7    16  1977       1 DM         F                  34     NA
##  9        10     7    16  1977       6 PF         F                  20     NA
## 10        11     7    16  1977       5 DS         F                  53     NA
## # ℹ 12,769 more rows
## # ℹ 4 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
</div>
</div>
<div id="challenge-1-filtering-and-selecting" class="section level2 challenge" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Challenge 1: Filtering and selecting<a class="anchor" aria-label="anchor" href="#challenge-1-filtering-and-selecting"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>Use the surveys data to make a data.frame that has only data with years from 1980 to 1985.</li>
</ol>
<div class="solution">
<p><span id="unlabeled-div-12" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">1980</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">1985</span><span class="op">)</span></span></code></pre></div>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Use the surveys data to make a data.frame that has only the following columns, in order: <code>year</code>, <code>month</code>, <code>species_id</code>, <code>plot_id</code>.</li>
</ol>
<div class="solution">
<p><span id="unlabeled-div-13" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">species_id</span>, <span class="va">plot_id</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="the-pipe" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> The pipe: <code>%&gt;%</code><a class="anchor" aria-label="anchor" href="#the-pipe"><i class="fas fa-link"></i></a>
</h2>
<p>What happens if we want to both <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> our data? We have a couple options. First, we could use <strong>nested</strong> functions:</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="op">-</span><span class="va">day</span><span class="op">)</span>, <span class="va">month</span> <span class="op">&gt;=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 8,244 × 12
##    record_id month  year plot_id species_id sex   hindfoot_length weight genus  
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  
##  1         1     7  1977       2 NL         M                  32     NA Neotoma
##  2         2     7  1977       3 NL         M                  33     NA Neotoma
##  3         3     7  1977       2 DM         F                  37     NA Dipodo…
##  4         4     7  1977       7 DM         M                  36     NA Dipodo…
##  5         5     7  1977       3 DM         M                  35     NA Dipodo…
##  6         6     7  1977       1 PF         M                  14     NA Perogn…
##  7         7     7  1977       2 PE         F                  NA     NA Peromy…
##  8         8     7  1977       1 DM         M                  37     NA Dipodo…
##  9         9     7  1977       1 DM         F                  34     NA Dipodo…
## 10        10     7  1977       6 PF         F                  20     NA Perogn…
## # ℹ 8,234 more rows
## # ℹ 3 more variables: species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<p>R will evaluate statements from the inside out. First, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> will operate on the <code>surveys</code> data.frame, removing the column <code>day</code>. The resulting data.frame is then used as the first argument for <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, which selects rows with a month greater than or equal to 7.</p>
<p>Nested functions can be very difficult to read with only a few functions, and nearly impossible when many functions are done at once. An alternative approach is to create <strong>intermediate</strong> objects:</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_noday</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">surveys</span>, <span class="op">-</span><span class="va">day</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">surveys_noday</span>, <span class="va">month</span> <span class="op">&gt;=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 8,244 × 12
##    record_id month  year plot_id species_id sex   hindfoot_length weight genus  
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  
##  1         1     7  1977       2 NL         M                  32     NA Neotoma
##  2         2     7  1977       3 NL         M                  33     NA Neotoma
##  3         3     7  1977       2 DM         F                  37     NA Dipodo…
##  4         4     7  1977       7 DM         M                  36     NA Dipodo…
##  5         5     7  1977       3 DM         M                  35     NA Dipodo…
##  6         6     7  1977       1 PF         M                  14     NA Perogn…
##  7         7     7  1977       2 PE         F                  NA     NA Peromy…
##  8         8     7  1977       1 DM         M                  37     NA Dipodo…
##  9         9     7  1977       1 DM         F                  34     NA Dipodo…
## 10        10     7  1977       6 PF         F                  20     NA Perogn…
## # ℹ 8,234 more rows
## # ℹ 3 more variables: species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<p>This approach is easier to read, since we can see the steps in order, but after enough steps, we are left with a cluttered mess of intermediate objects, often with confusing names.</p>
<p>An elegant solution to this problem is an operator called the <strong>pipe</strong>, which looks like <code>%&gt;%</code>. You can insert it by using the keyboard shortcut <kbd>Shift+Cmd+M</kbd> (Mac) or <kbd>Shift+Ctrl+M</kbd> (Windows). Here’s how you could use a pipe to select and filter in one step:</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">month</span> <span class="op">&gt;=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 8,244 × 12
##    record_id month  year plot_id species_id sex   hindfoot_length weight genus  
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  
##  1         1     7  1977       2 NL         M                  32     NA Neotoma
##  2         2     7  1977       3 NL         M                  33     NA Neotoma
##  3         3     7  1977       2 DM         F                  37     NA Dipodo…
##  4         4     7  1977       7 DM         M                  36     NA Dipodo…
##  5         5     7  1977       3 DM         M                  35     NA Dipodo…
##  6         6     7  1977       1 PF         M                  14     NA Perogn…
##  7         7     7  1977       2 PE         F                  NA     NA Peromy…
##  8         8     7  1977       1 DM         M                  37     NA Dipodo…
##  9         9     7  1977       1 DM         F                  34     NA Dipodo…
## 10        10     7  1977       6 PF         F                  20     NA Perogn…
## # ℹ 8,234 more rows
## # ℹ 3 more variables: species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<p>What it does is take the thing on the lefthand side and insert it as the first argument of the function on the righthand side. By putting each of our functions onto a new line, we can build a nice, readable <strong>pipeline</strong>. It can be useful to think of this as a little assembly line for our data. It starts at the top and gets piped into a <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> function, and it comes out modified somewhat. It then gets sent into the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function, where it is further modified, and then the final product gets printed out to our console. It can also be helpful to think of <code>%&gt;%</code> as meaning “and then”. Since many <code>tidyverse</code> functions have verbs for names, a pipeline can be read like a sentence.</p>
<div class="instructor">
<p>It’s worth showing the learners that you can run a <strong>pipeline</strong> without highlighting the whole thing. If your cursor is on any line of a pipeline, running that line will run the whole thing.</p>
<p>You can also show that by highlighting a section of a pipeline, you can run only the first X steps of it.</p>
</div>
<p>If we want to store this final product as an object, we use an assignment arrow at the start:</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_sub</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">month</span> <span class="op">&gt;=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>A good approach is to build a pipeline step by step prior to assignment. You add functions to the pipeline as you go, with the results printing in the console for you to view. Once you’re satisfied with your final result, go back and add the assignment arrow statement at the start. This approach is very interactive, allowing you to see the results of each step as you build the pipeline, and produces nicely readable code.</p>
</div>
<div id="challenge-2-using-pipes" class="section level2 challenge" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Challenge 2: Using pipes<a class="anchor" aria-label="anchor" href="#challenge-2-using-pipes"><i class="fas fa-link"></i></a>
</h2>
<p>Use the surveys data to make a data.frame that has the columns <code>record_id</code>, <code>month</code>, and <code>species_id</code>, with data from the year 1988. Use a pipe between the function calls.</p>
<div class="solution">
<p><span id="unlabeled-div-14" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_1988</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1988</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">record_id</span>, <span class="va">month</span>, <span class="va">species_id</span><span class="op">)</span></span></code></pre></div>
<p>Make sure to <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> before you <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>. You need to use the <code>year</code> column for filtering rows, but it is discarded in the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> step. You also need to make sure to use <code>==</code> instead of <code>=</code> when you are filtering rows where <code>year</code> is equal to 1988.</p>
</div>
</div>
<div id="making-new-columns-with-mutate" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Making new columns with <code>mutate()</code><a class="anchor" aria-label="anchor" href="#making-new-columns-with-mutate"><i class="fas fa-link"></i></a>
</h2>
<p>Another common task is creating a new column based on values in existing columns. For example, we could add a new column that has the weight in kilograms instead of grams:</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>weight_kg <span class="op">=</span> <span class="va">weight</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 14
##    record_id month   day  year plot_id species_id sex   hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1         1     7    16  1977       2 NL         M                  32     NA
##  2         2     7    16  1977       3 NL         M                  33     NA
##  3         3     7    16  1977       2 DM         F                  37     NA
##  4         4     7    16  1977       7 DM         M                  36     NA
##  5         5     7    16  1977       3 DM         M                  35     NA
##  6         6     7    16  1977       1 PF         M                  14     NA
##  7         7     7    16  1977       2 PE         F                  NA     NA
##  8         8     7    16  1977       1 DM         M                  37     NA
##  9         9     7    16  1977       1 DM         F                  34     NA
## 10        10     7    16  1977       6 PF         F                  20     NA
## # ℹ 16,868 more rows
## # ℹ 5 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;,
## #   weight_kg &lt;dbl&gt;</code></pre>
<p>You can create multiple columns in one <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> call, and they will get created in the order you write them. This means you can even reference the first new column in the second new column:</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>weight_kg <span class="op">=</span> <span class="va">weight</span> <span class="op">/</span> <span class="fl">1000</span>,</span>
<span>         weight_lbs <span class="op">=</span> <span class="va">weight_kg</span> <span class="op">*</span> <span class="fl">2.2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 15
##    record_id month   day  year plot_id species_id sex   hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1         1     7    16  1977       2 NL         M                  32     NA
##  2         2     7    16  1977       3 NL         M                  33     NA
##  3         3     7    16  1977       2 DM         F                  37     NA
##  4         4     7    16  1977       7 DM         M                  36     NA
##  5         5     7    16  1977       3 DM         M                  35     NA
##  6         6     7    16  1977       1 PF         M                  14     NA
##  7         7     7    16  1977       2 PE         F                  NA     NA
##  8         8     7    16  1977       1 DM         M                  37     NA
##  9         9     7    16  1977       1 DM         F                  34     NA
## 10        10     7    16  1977       6 PF         F                  20     NA
## # ℹ 16,868 more rows
## # ℹ 6 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;,
## #   weight_kg &lt;dbl&gt;, weight_lbs &lt;dbl&gt;</code></pre>
<!-- This next part could definitely be moved to the next lesson if need be -->
<p>We can also use multiple columns to create a single column. For example, it’s often good practice to keep the components of a date in separate columns until necessary, as we’ve done here. This is because programs like Excel can do automatic things with dates in a way that is not reproducible and sometimes hard to notice. However, now that we are working in R, we can safely put together a date column.</p>
<p>To put together the columns into something that looks like a date, we can use the <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> function, which takes arguments of the items to paste together, as well as the argument <code>sep</code>, which is the character used to separate the items.</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 14
##    record_id month   day  year plot_id species_id sex   hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1         1     7    16  1977       2 NL         M                  32     NA
##  2         2     7    16  1977       3 NL         M                  33     NA
##  3         3     7    16  1977       2 DM         F                  37     NA
##  4         4     7    16  1977       7 DM         M                  36     NA
##  5         5     7    16  1977       3 DM         M                  35     NA
##  6         6     7    16  1977       1 PF         M                  14     NA
##  7         7     7    16  1977       2 PE         F                  NA     NA
##  8         8     7    16  1977       1 DM         M                  37     NA
##  9         9     7    16  1977       1 DM         F                  34     NA
## 10        10     7    16  1977       6 PF         F                  20     NA
## # ℹ 16,868 more rows
## # ℹ 5 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;,
## #   date &lt;chr&gt;</code></pre>
<p>Since our new column gets moved all the way to the end, it doesn’t end up printing out. We can use the <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> function to put it after our <code>year</code> column:</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">date</span>, .after <span class="op">=</span> <span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 14
##    record_id month   day  year date     plot_id species_id sex   hindfoot_length
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;
##  1         1     7    16  1977 1977-7-…       2 NL         M                  32
##  2         2     7    16  1977 1977-7-…       3 NL         M                  33
##  3         3     7    16  1977 1977-7-…       2 DM         F                  37
##  4         4     7    16  1977 1977-7-…       7 DM         M                  36
##  5         5     7    16  1977 1977-7-…       3 DM         M                  35
##  6         6     7    16  1977 1977-7-…       1 PF         M                  14
##  7         7     7    16  1977 1977-7-…       2 PE         F                  NA
##  8         8     7    16  1977 1977-7-…       1 DM         M                  37
##  9         9     7    16  1977 1977-7-…       1 DM         F                  34
## 10        10     7    16  1977 1977-7-…       6 PF         F                  20
## # ℹ 16,868 more rows
## # ℹ 5 more variables: weight &lt;dbl&gt;, genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;,
## #   plot_type &lt;chr&gt;</code></pre>
<p>Now we can see that we have a character column that contains our date string. However, it’s not truly a date column. Dates are a type of numeric variable with a defined, ordered scale. To turn this column into a proper date, we will use a function from the <code>tidyverse</code>’s <code>lubridate</code> package, which has lots of useful functions for working with dates. The function <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code> will parse a date string that has the order year-month-day. Let’s load the package and use <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code>.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>,</span>
<span>         date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">date</span>, .after <span class="op">=</span> <span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 14
##    record_id month   day  year date       plot_id species_id sex  
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;       &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;
##  1         1     7    16  1977 1977-07-16       2 NL         M    
##  2         2     7    16  1977 1977-07-16       3 NL         M    
##  3         3     7    16  1977 1977-07-16       2 DM         F    
##  4         4     7    16  1977 1977-07-16       7 DM         M    
##  5         5     7    16  1977 1977-07-16       3 DM         M    
##  6         6     7    16  1977 1977-07-16       1 PF         M    
##  7         7     7    16  1977 1977-07-16       2 PE         F    
##  8         8     7    16  1977 1977-07-16       1 DM         M    
##  9         9     7    16  1977 1977-07-16       1 DM         F    
## 10        10     7    16  1977 1977-07-16       6 PF         F    
## # ℹ 16,868 more rows
## # ℹ 6 more variables: hindfoot_length &lt;dbl&gt;, weight &lt;dbl&gt;, genus &lt;chr&gt;,
## #   species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>,</span>
<span>         date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">date</span>, .after <span class="op">=</span> <span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 14
##    record_id month   day  year date       plot_id species_id sex  
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;       &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;
##  1         1     7    16  1977 1977-07-16       2 NL         M    
##  2         2     7    16  1977 1977-07-16       3 NL         M    
##  3         3     7    16  1977 1977-07-16       2 DM         F    
##  4         4     7    16  1977 1977-07-16       7 DM         M    
##  5         5     7    16  1977 1977-07-16       3 DM         M    
##  6         6     7    16  1977 1977-07-16       1 PF         M    
##  7         7     7    16  1977 1977-07-16       2 PE         F    
##  8         8     7    16  1977 1977-07-16       1 DM         M    
##  9         9     7    16  1977 1977-07-16       1 DM         F    
## 10        10     7    16  1977 1977-07-16       6 PF         F    
## # ℹ 16,868 more rows
## # ℹ 6 more variables: hindfoot_length &lt;dbl&gt;, weight &lt;dbl&gt;, genus &lt;chr&gt;,
## #   species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<!-- This isn't strictly necessary to show, but I think it's good to reenforce what a pipe is really doing, and it's actually a useful approach with more complex mutates -->
<p>Now we can see that our <code>date</code> column has the type <code>date</code> as well. In this example, we created our column with two separate lines in <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, but we can combine them into one:</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using nested functions</span></span>
<span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">date</span>, .after <span class="op">=</span> <span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 14
##    record_id month   day  year date       plot_id species_id sex  
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;       &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;
##  1         1     7    16  1977 1977-07-16       2 NL         M    
##  2         2     7    16  1977 1977-07-16       3 NL         M    
##  3         3     7    16  1977 1977-07-16       2 DM         F    
##  4         4     7    16  1977 1977-07-16       7 DM         M    
##  5         5     7    16  1977 1977-07-16       3 DM         M    
##  6         6     7    16  1977 1977-07-16       1 PF         M    
##  7         7     7    16  1977 1977-07-16       2 PE         F    
##  8         8     7    16  1977 1977-07-16       1 DM         M    
##  9         9     7    16  1977 1977-07-16       1 DM         F    
## 10        10     7    16  1977 1977-07-16       6 PF         F    
## # ℹ 16,868 more rows
## # ℹ 6 more variables: hindfoot_length &lt;dbl&gt;, weight &lt;dbl&gt;, genus &lt;chr&gt;,
## #   species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using a pipe *inside* mutate()</span></span>
<span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, </span>
<span>                      sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">date</span>, .after <span class="op">=</span> <span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 14
##    record_id month   day  year date       plot_id species_id sex  
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;       &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;
##  1         1     7    16  1977 1977-07-16       2 NL         M    
##  2         2     7    16  1977 1977-07-16       3 NL         M    
##  3         3     7    16  1977 1977-07-16       2 DM         F    
##  4         4     7    16  1977 1977-07-16       7 DM         M    
##  5         5     7    16  1977 1977-07-16       3 DM         M    
##  6         6     7    16  1977 1977-07-16       1 PF         M    
##  7         7     7    16  1977 1977-07-16       2 PE         F    
##  8         8     7    16  1977 1977-07-16       1 DM         M    
##  9         9     7    16  1977 1977-07-16       1 DM         F    
## 10        10     7    16  1977 1977-07-16       6 PF         F    
## # ℹ 16,868 more rows
## # ℹ 6 more variables: hindfoot_length &lt;dbl&gt;, weight &lt;dbl&gt;, genus &lt;chr&gt;,
## #   species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
</div>
<div id="challenge-3-plotting-date" class="section level2 challenge" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Challenge 3: Plotting date<a class="anchor" aria-label="anchor" href="#challenge-3-plotting-date"><i class="fas fa-link"></i></a>
</h2>
<p>Because the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function takes the data as its first argument, you can actually pipe data straight into <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>. Try building a pipeline that creates the date column and plots weight across date.</p>
<div class="solution">
<p><span id="unlabeled-div-15" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Removed 1692 rows containing missing values or values outside the scale
## range (`geom_point()`).</code></pre>
<div class="inline-figure"><img src="usace_R_training_files/figure-html/date-plot-challenge-answer-1.png" width="600" height="600"></div>
<p>This isn’t necessarily the most useful plot, but we will learn some techniques that will help produce nice time series plots</p>
</div>
</div>
<div id="the-split-apply-combine-approach" class="section level2" number="4.9">
<h2>
<span class="header-section-number">4.9</span> The split-apply-combine approach<a class="anchor" aria-label="anchor" href="#the-split-apply-combine-approach"><i class="fas fa-link"></i></a>
</h2>
<p>Many data analysis tasks can be achieved using the split-apply-combine approach: you split the data into groups, apply some analysis to each group, and combine the results in some way. <code>dplyr</code> has a few convenient functions to enable this approach, the main two being <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>.</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> takes a data.frame and the name of one or more columns with categorical values that define the groups. <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> then collapses each group into a one-row summary of the group, giving you back a data.frame with one row per group. The syntax for <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> is similar to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, where you define new columns based on values of other columns. Let’s try calculating the mean weight of all our animals by sex.</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   sex   mean_weight
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 F            53.1
## 2 M            53.2
## 3 &lt;NA&gt;         74.0</code></pre>
<p>You can see that the mean weight for males is slightly higher than for females, but that animals whose sex is unknown have much higher weights. This is probably due to small sample size, but we should check to be sure. Like <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, we can define multiple columns in one <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> call. The function <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> will count the number of rows in each group.</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   sex   mean_weight     n
##   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
## 1 F            53.1  7318
## 2 M            53.2  8260
## 3 &lt;NA&gt;         74.0  1300</code></pre>
<p>You will often want to create groups based on multiple columns. For example, we might be interested in the mean weight of every species + sex combination. All we have to do is add another column to our <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> call.</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'species_id'. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 67 × 4
## # Groups:   species_id [36]
##    species_id sex   mean_weight     n
##    &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
##  1 AB         &lt;NA&gt;        NaN     223
##  2 AH         &lt;NA&gt;        NaN     136
##  3 BA         M             7       3
##  4 CB         &lt;NA&gt;        NaN      23
##  5 CM         &lt;NA&gt;        NaN      13
##  6 CQ         &lt;NA&gt;        NaN      16
##  7 CS         &lt;NA&gt;        NaN       1
##  8 CV         &lt;NA&gt;        NaN       1
##  9 DM         F            40.7  2522
## 10 DM         M            44.0  3108
## # ℹ 57 more rows</code></pre>
<p>Our resulting data.frame is much larger, since we have a greater number of groups. We also see a strange value showing up in our <code>mean_weight</code> column: <code>NaN</code>. This stands for “Not a Number”, and it often results from trying to do an operation a vector with zero entries. How can a vector have zero entries? Well, if a particular group (like the AB species ID + <code>NA</code> sex group) has <strong>only</strong> <code>NA</code> values for weight, then the <code>na.rm = T</code> argument in <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> will remove <strong>all</strong> the values prior to calculating the mean. The result will be a value of <code>NaN</code>. Since we are not particularly interested in these values, let’s add a step to our pipeline to remove rows where weight is <code>NA</code> <strong>before</strong> doing any other steps. This means that any groups with only <code>NA</code> values will disappear from our data.frame before we formally create the groups with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>.</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'species_id'. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 46 × 4
## # Groups:   species_id [18]
##    species_id sex   mean_weight     n
##    &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
##  1 BA         M             7       3
##  2 DM         F            40.7  2460
##  3 DM         M            44.0  3013
##  4 DM         &lt;NA&gt;         37       8
##  5 DO         F            48.4   679
##  6 DO         M            49.3   748
##  7 DO         &lt;NA&gt;         44       1
##  8 DS         F           118.   1055
##  9 DS         M           123.   1184
## 10 DS         &lt;NA&gt;        121.     16
## # ℹ 36 more rows</code></pre>
<p>That looks better! It’s often useful to take a look at the results in some order, like the lowest mean weight to highest. We can use the <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> function for that:</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">mean_weight</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'species_id'. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 46 × 4
## # Groups:   species_id [18]
##    species_id sex   mean_weight     n
##    &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
##  1 PF         &lt;NA&gt;         6        2
##  2 BA         M            7        3
##  3 PF         F            7.09   215
##  4 PF         M            7.10   296
##  5 RM         M            9.92   678
##  6 RM         &lt;NA&gt;        10.4      7
##  7 RM         F           10.7    629
##  8 RF         M           12.4     16
##  9 RF         F           13.7     46
## 10 PP         &lt;NA&gt;        15        2
## # ℹ 36 more rows</code></pre>
<p>If we want to reverse the order, we can wrap the column name in <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code>:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">mean_weight</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'species_id'. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 46 × 4
## # Groups:   species_id [18]
##    species_id sex   mean_weight     n
##    &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
##  1 NL         M           168.    355
##  2 NL         &lt;NA&gt;        164.      9
##  3 NL         F           151.    460
##  4 SS         M           130       1
##  5 DS         M           123.   1184
##  6 DS         &lt;NA&gt;        121.     16
##  7 DS         F           118.   1055
##  8 SH         F            79.2    61
##  9 SH         M            67.6    34
## 10 SF         F            58.3     3
## # ℹ 36 more rows</code></pre>
<p>You may have seen several messages saying <code>summarise() has grouped output by 'species_id'. You can override using the .groups argument.</code> These are warning you that your resulting data.frame has retained some group structure, which means any subsequent operations on that data.frame will happen at the group level. If you look at the resulting data.frame printed out in your console, you will see these lines:</p>
<pre><code># A tibble: 46 × 4
# Groups:   species_id [18]</code></pre>
<p>They tell us we have a data.frame with 46 rows, 4 columns, and a group variable <code>species_id</code>, for which there are 18 groups. We will see something similar if we use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> alone:</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 16,878 × 13
## # Groups:   species_id, sex [67]
##    record_id month   day  year plot_id species_id sex   hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1         1     7    16  1977       2 NL         M                  32     NA
##  2         2     7    16  1977       3 NL         M                  33     NA
##  3         3     7    16  1977       2 DM         F                  37     NA
##  4         4     7    16  1977       7 DM         M                  36     NA
##  5         5     7    16  1977       3 DM         M                  35     NA
##  6         6     7    16  1977       1 PF         M                  14     NA
##  7         7     7    16  1977       2 PE         F                  NA     NA
##  8         8     7    16  1977       1 DM         M                  37     NA
##  9         9     7    16  1977       1 DM         F                  34     NA
## 10        10     7    16  1977       6 PF         F                  20     NA
## # ℹ 16,868 more rows
## # ℹ 4 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</code></pre>
<p>What we get back is the entire <code>surveys</code> data.frame, but with the grouping variables added: 67 groups of <code>species_id</code> + <code>sex</code> combinations. Groups are often maintained throughout a pipeline, and if you assign the resulting data.frame to a new object, it will also have those groups. This can lead to confusing results if you forget about the grouping and want to carry out operations on the whole data.frame, not by group. Therefore, it is a good habit to remove the groups at the end of a pipeline containing <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>:</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">mean_weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'species_id'. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 46 × 4
##    species_id sex   mean_weight     n
##    &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;
##  1 NL         M           168.    355
##  2 NL         &lt;NA&gt;        164.      9
##  3 NL         F           151.    460
##  4 SS         M           130       1
##  5 DS         M           123.   1184
##  6 DS         &lt;NA&gt;        121.     16
##  7 DS         F           118.   1055
##  8 SH         F            79.2    61
##  9 SH         M            67.6    34
## 10 SF         F            58.3     3
## # ℹ 36 more rows</code></pre>
<p>Now our data.frame just says <code># A tibble: 46 × 4</code> at the top, with no groups.</p>
<p>While it is common that you will want to get the one-row-per-group summary that <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> provides, there are times where you want to calculate a per-group value but keep all the rows in your data.frame. For example, we might want to know the mean weight for each species ID + sex combination, and then we might want to know how far from that mean value each observation in the group is. For this, we can use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> together:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            weight_diff <span class="op">=</span> <span class="va">weight</span> <span class="op">-</span> <span class="va">mean_weight</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 15,186 × 15
## # Groups:   species_id, sex [46]
##    record_id month   day  year plot_id species_id sex   hindfoot_length weight
##        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;
##  1        63     8    19  1977       3 DM         M                  35     40
##  2        64     8    19  1977       7 DM         M                  37     48
##  3        65     8    19  1977       4 DM         F                  34     29
##  4        66     8    19  1977       4 DM         F                  35     46
##  5        67     8    19  1977       7 DM         M                  35     36
##  6        68     8    19  1977       8 DO         F                  32     52
##  7        69     8    19  1977       2 PF         M                  15      8
##  8        70     8    19  1977       3 OX         F                  21     22
##  9        71     8    19  1977       7 DM         F                  36     35
## 10        74     8    19  1977       8 PF         M                  12      7
## # ℹ 15,176 more rows
## # ℹ 6 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;,
## #   mean_weight &lt;dbl&gt;, weight_diff &lt;dbl&gt;</code></pre>
<p>Since we get all our columns back, the new columns are at the very end and don’t print out in the console. Let’s use <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to just look at the columns of interest. Inside <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> we can use the <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> function to get any column containing the word “weight” in the name:</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            weight_diff <span class="op">=</span> <span class="va">weight</span> <span class="op">-</span> <span class="va">mean_weight</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"weight"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 15,186 × 5
## # Groups:   species_id, sex [46]
##    species_id sex   weight mean_weight weight_diff
##    &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 DM         M         40       44.0      -4.00  
##  2 DM         M         48       44.0       4.00  
##  3 DM         F         29       40.7     -11.7   
##  4 DM         F         46       40.7       5.28  
##  5 DM         M         36       44.0      -8.00  
##  6 DO         F         52       48.4       3.63  
##  7 PF         M          8        7.10      0.902 
##  8 OX         F         22       21         1     
##  9 DM         F         35       40.7      -5.72  
## 10 PF         M          7        7.10     -0.0980
## # ℹ 15,176 more rows</code></pre>
<p>What happens with the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> + <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> combination is similar to using <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>: for each group, the mean weight is calculated. However, instead of reporting only one row per group, the mean weight for each group is added to each row in that group. For each row in a group (like DM species ID + M sex), you will see the same value in <code>mean_weight</code>.</p>
</div>
<div id="challenge-4-making-a-time-series" class="section level2 challenge" number="4.10">
<h2>
<span class="header-section-number">4.10</span> Challenge 4: Making a time series<a class="anchor" aria-label="anchor" href="#challenge-4-making-a-time-series"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>Use the split-apply-combine approach to make a <code>data.frame</code> that counts the total number of animals of each sex caught on each day in the <code>surveys</code> data.</li>
</ol>
<div class="solution">
<p><span id="unlabeled-div-16" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_daily_counts</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'date'. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># shorter approach using count()</span></span>
<span><span class="va">surveys_daily_counts</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">sex</span><span class="op">)</span></span></code></pre></div>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Now use the data.frame you just made to plot the daily number of animals of each sex caught over time. It’s up to you what <code>geom</code> to use, but a <code>line</code> plot might be a good choice. You should also think about how to differentiate which data corresponds to which sex.</li>
</ol>
<div class="solution">
<p><span id="unlabeled-div-17" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_daily_counts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="usace_R_training_files/figure-html/time-series-challenge-answer-1.png" width="600" height="600"></div>
</div>
</div>
<div id="reshaping-data-with-tidyr" class="section level2" number="4.11">
<h2>
<span class="header-section-number">4.11</span> Reshaping data with <code>tidyr</code><a class="anchor" aria-label="anchor" href="#reshaping-data-with-tidyr"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s say we are interested in comparing the mean weights of each species across our different plots. We can begin this process using the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> + <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> approach:</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_by_plot</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">plot_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">plot_id</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'species_id'. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_by_plot</span></span></code></pre></div>
<pre><code>## # A tibble: 300 × 3
## # Groups:   species_id [18]
##    species_id plot_id mean_weight
##    &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1 BA               3         8  
##  2 BA              21         6.5
##  3 DM               1        42.7
##  4 DM               2        42.6
##  5 DM               3        41.2
##  6 DM               4        41.9
##  7 DM               5        42.6
##  8 DM               6        42.1
##  9 DM               7        43.2
## 10 DM               8        43.4
## # ℹ 290 more rows</code></pre>
<p>That looks great, but it is a bit difficult to compare values across plots. It would be nice if we could reshape this data.frame to make those comparisons easier. Well, the <code>tidyr</code> package from the <code>tidyverse</code> has a pair of functions that allow you to reshape data by pivoting it: <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> will make the data wider, which means increasing the number of columns and reducing the number of rows. <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> will do the opposite, reducing the number of columns and increasing the number of rows.</p>
<p>In this case, it might be nice to create a data.frame where each species has its own row, and each plot has its own column containing the mean weight for a given species. We will use <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> to reshape our data in this way. It takes 3 arguments:</p>
<ol style="list-style-type: decimal">
<li>the name of the data.frame</li>
<li>
<code>names_from</code>: which column should be used to generate the names of the new columns?</li>
<li>
<code>values_from</code>: which column should be used to fill in the values of the new columns?</li>
</ol>
<p>Any columns not used for <code>names_from</code> or <code>values_from</code> will not be pivoted.</p>
<p><img src="images/pivot_wider.png">{alt=‘Diagram depicting the behavior of <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> on a small tabular dataset.’; width = 100%}</p>
<p>In our case, we want the new columns to be named from our <code>plot_id</code> column, with the values coming from the <code>mean_weight</code> column. We can pipe our data.frame right into <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> and add those two arguments:</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_by_plot_wide</span> <span class="op">&lt;-</span> <span class="va">sp_by_plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">plot_id</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">mean_weight</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sp_by_plot_wide</span></span></code></pre></div>
<pre><code>## # A tibble: 18 × 25
## # Groups:   species_id [18]
##    species_id    `3`   `21`    `1`    `2`    `4`   `5`    `6`   `7`    `8`
##    &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 BA           8      6.5   NA     NA     NA     NA    NA     NA    NA   
##  2 DM          41.2   41.5   42.7   42.6   41.9   42.6  42.1   43.2  43.4 
##  3 DO          42.7   NA     50.1   50.3   46.8   50.4  49.0   52    49.2 
##  4 DS         128.    NA    129.   125.   118.   111.  114.   126.  128.  
##  5 NL         171.   136.   154.   171.   164.   192.  176.   170.  134.  
##  6 OL          32.1   28.6   35.5   34     33.0   32.6  31.8   NA    30.3 
##  7 OT          24.1   24.1   23.7   24.9   26.5   23.6  23.5   22    24.1 
##  8 OX          22     NA     NA     22     NA     20    NA     NA    NA   
##  9 PE          22.7   19.6   21.6   22.0   NA     21    21.6   22.8  19.4 
## 10 PF           7.12   7.23   6.57   6.89   6.75   7.5   7.54   7     6.78
## 11 PH          28     31     NA     NA     NA     29    NA     NA    NA   
## 12 PM          20.1   23.6   23.7   23.9   NA     23.7  22.3   23.4  23   
## 13 PP          17.1   13.6   14.3   16.4   14.8   19.8  16.8   NA    13.9 
## 14 RF          14.8   17     NA     16     NA     14    12.1   13    NA   
## 15 RM          10.3    9.89  10.9   10.6   10.4   10.8  10.6   10.7   9   
## 16 SF          NA     49     NA     NA     NA     NA    NA     NA    NA   
## 17 SH          76.0   79.9   NA     88     NA     82.7  NA     NA    NA   
## 18 SS          NA     NA     NA     NA     NA     NA    NA     NA    NA   
## # ℹ 15 more variables: `9` &lt;dbl&gt;, `10` &lt;dbl&gt;, `11` &lt;dbl&gt;, `12` &lt;dbl&gt;,
## #   `13` &lt;dbl&gt;, `14` &lt;dbl&gt;, `15` &lt;dbl&gt;, `16` &lt;dbl&gt;, `17` &lt;dbl&gt;, `18` &lt;dbl&gt;,
## #   `19` &lt;dbl&gt;, `20` &lt;dbl&gt;, `22` &lt;dbl&gt;, `23` &lt;dbl&gt;, `24` &lt;dbl&gt;</code></pre>
<p>Now we’ve got our reshaped data.frame. There are a few things to notice. First, we have a new column for each <code>plot_id</code> value. There is one old column left in the data.frame: <code>species_id</code>. It wasn’t used in <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>, so it stays, and now contains a single entry for each unique <code>species_id</code> value.</p>
<p>Finally, a lot of <code>NA</code>s have appeared. Some species aren’t found in every plot, but because a data.frame has to have a value in every row and every column, an <code>NA</code> is inserted. We can double-check this to verify what is going on.</p>
<p>Looking in our new pivoted data.frame, we can see that there is an <code>NA</code> value for the species <code>BA</code> in plot <code>1</code>. Let’s take our <code>sp_by_plot</code> data.frame and look for the <code>mean_weight</code> of that species + plot combination.</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_by_plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species_id</span> <span class="op">==</span> <span class="st">"BA"</span> <span class="op">&amp;</span> <span class="va">plot_id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 3
## # Groups:   species_id [0]
## # ℹ 3 variables: species_id &lt;chr&gt;, plot_id &lt;dbl&gt;, mean_weight &lt;dbl&gt;</code></pre>
<p>We get back 0 rows. There is no <code>mean_weight</code> for the species <code>BA</code> in plot <code>1</code>. This either happened because no <code>BA</code> were ever caught in plot <code>1</code>, or because every <code>BA</code> caught in plot <code>1</code> had an <code>NA</code> weight value and all the rows got removed when we used <code>filter(!is.na(weight))</code> in the process of making <code>sp_by_plot</code>. Because there are no rows with that species + plot combination, in our pivoted data.frame, the value gets filled with <code>NA</code>.</p>
<p>There is another <code>pivot_</code> function that does the opposite, moving data from a wide to long format, called <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. It takes 3 arguments: <code>cols</code> for the columns you want to pivot, <code>names_to</code> for the name of the new column which will contain the old column names, and <code>values_to</code> for the name of the new column which will contain the old values.</p>
<p><img src="images/pivot_longer.png">{alt=‘Diagram depicting the behavior of <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> on a small tabular dataset.’; width = 100%}</p>
<p>We can pivot our new wide data.frame to a long format using <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. We want to pivot all the columns except <code>species_id</code>, and we will use <code>PLOT</code> for the new column of plot IDs, and <code>MEAN_WT</code> for the new column of mean weight values.</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_by_plot_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">species_id</span>, names_to <span class="op">=</span> <span class="st">"PLOT"</span>, values_to <span class="op">=</span> <span class="st">"MEAN_WT"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 432 × 3
## # Groups:   species_id [18]
##    species_id PLOT  MEAN_WT
##    &lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt;
##  1 BA         3         8  
##  2 BA         21        6.5
##  3 BA         1        NA  
##  4 BA         2        NA  
##  5 BA         4        NA  
##  6 BA         5        NA  
##  7 BA         6        NA  
##  8 BA         7        NA  
##  9 BA         8        NA  
## 10 BA         9        NA  
## # ℹ 422 more rows</code></pre>
<p>One thing you will notice is that all those <code>NA</code> values that got generated when we pivoted wider. However, we can filter those out, which gets us back to the same data as <code>sp_by_plot</code>, before we pivoted it wider.</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_by_plot_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">species_id</span>, names_to <span class="op">=</span> <span class="st">"PLOT"</span>, values_to <span class="op">=</span> <span class="st">"MEAN_WT"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">MEAN_WT</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 300 × 3
## # Groups:   species_id [18]
##    species_id PLOT  MEAN_WT
##    &lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt;
##  1 BA         3         8  
##  2 BA         21        6.5
##  3 DM         3        41.2
##  4 DM         21       41.5
##  5 DM         1        42.7
##  6 DM         2        42.6
##  7 DM         4        41.9
##  8 DM         5        42.6
##  9 DM         6        42.1
## 10 DM         7        43.2
## # ℹ 290 more rows</code></pre>
<p>Data are often recorded in spreadsheets in a wider format, but lots of <code>tidyverse</code> tools, especially <code>ggplot2</code>, like data in a longer format, so <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> is often very useful.</p>
</div>
<div id="other-key-data-tools" class="section level2" number="4.12">
<h2>
<span class="header-section-number">4.12</span> Other key data tools<a class="anchor" aria-label="anchor" href="#other-key-data-tools"><i class="fas fa-link"></i></a>
</h2>
<div id="for-loops" class="section level3" number="4.12.1">
<h3>
<span class="header-section-number">4.12.1</span> For-loops<a class="anchor" aria-label="anchor" href="#for-loops"><i class="fas fa-link"></i></a>
</h3>
<p>Looping</p>
<p>A for loop allows you to repeat code. You specify a variable and a range of values and the for loop runs the
code for each value in your range. There are other ways to repeat code (e.g. apply suite of functions), but we
are only going to discuss for loops (some in the R world think loops are be bad since R is optimized for working
on vectors, but the concept is useful). The basic structure looks like:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="manipulating-tabular-data.html#cb247-1" tabindex="-1"></a><span class="cf">for</span>(a_name <span class="cf">in</span> a_range) {</span>
<span id="cb247-2"><a href="manipulating-tabular-data.html#cb247-2" tabindex="-1"></a>  code you want to run</span>
<span id="cb247-3"><a href="manipulating-tabular-data.html#cb247-3" tabindex="-1"></a>  may or may not use a_name</span>
<span id="cb247-4"><a href="manipulating-tabular-data.html#cb247-4" tabindex="-1"></a>}</span></code></pre></div>
<p>Loops cycle through the “index” variable, which changes in each iteration. You must give this variable a name
(often people use “i” for index), and then tell it what values to cycle through. Let’s look at a loop that
only prints the value of the index variable each time.</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
<p>You’ll see that the value of i is printed at each loop iteration, and changes based on the values given after
in. Let’s try one more simple example, where we give nonconsecutive looping values.</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loopVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>, <span class="st">'vector'</span>, <span class="st">'of'</span>, <span class="st">'character'</span>, <span class="st">'values'</span>, <span class="st">'works'</span>, <span class="st">'too!'</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">word</span> <span class="kw">in</span> <span class="va">loopVec</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code>## [1] "a"
## [1] "vector"
## [1] "of"
## [1] "character"
## [1] "values"
## [1] "works"
## [1] "too!"</code></pre>
<p>This just illustrates that you can use manye different vector types as the looping vector. The for loop will
always use looping_vector[1] as the first value of the index, then looping_vector[2], and so on until it
gets to the last value of the looping vector. Now, let’s do something a little more useful inside our loop.</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sequentially increase the value of some number</span></span>
<span><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># variables used in loops must exist already - so we initialize them</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">vec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="va">j</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code>## [1] 1
## [1] 3
## [1] 6
## [1] 10
## [1] 15
## [1] 21
## [1] 28
## [1] 36
## [1] 45
## [1] 55</code></pre>
<p>Again a bit of a silly example since all it is doing is looping through a list of values and summing it.
In reality you would just use sum() or cumsum(). This also highlights the fact that loops in R can be slow
compared to vector operations and/or primitive operations (see Hadley Wickham’s section on Primitive functions).</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A simple vectorized operation</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">100</span><span class="op">:</span><span class="fl">1</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span><span class="va">z</span></span></code></pre></div>
<pre><code>##   [1] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
##  [19] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
##  [37] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
##  [55] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
##  [73] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
##  [91] 101 101 101 101 101 101 101 101 101 101</code></pre>
<p>This kind of thing doesn’t come easily with many languages. You would need to program it yourself using
a loop. For the sake of argument (and practice), let’s try the loop version with R. You’ll notice that
we have set out &lt;- NULL at the beginning. We are adding values to out using the loop, but the object must
exist first. Thus, we make it NULL or you can use out &lt;- c() if you know it will be a vector.</p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We will assume vectors of the same length...</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> </span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>So, these do the same thing, big deal. It is big though when you look at the timing of the two. Let’s
create two large vectors and see what happens.</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This happens almost instantaneously. This creates a new columns where there is a NA value </span></span>
<span><span class="co"># if the Flow_cd is "A e", otherwise it uses the value stored in the Flow column</span></span>
<span><span class="va">introDFRev</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">introDF</span>, Flow_rev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Flow_cd</span> <span class="op">==</span> <span class="st">"A e"</span>, <span class="cn">NA</span>, <span class="va">Flow</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Now if we looped through to check that we have to wait for this loop (~20 seconds) - Don't try the whole dataframe. It will take forever. </span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">introDFRev</span><span class="op">$</span><span class="va">Flow_cd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"A e"</span><span class="op">)</span> <span class="op">{</span> </span>
<span>       <span class="va">introDFRev</span><span class="op">$</span><span class="va">Flow_rev2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="cn">NA</span> </span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> </span>
<span>      <span class="va">introDFRev</span><span class="op">$</span><span class="va">Flow_rev2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">introDFRev</span><span class="op">$</span><span class="va">Flow</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> </span>
<span>      <span class="op">}</span></span>
<span><span class="op">}</span> <span class="co">#end loop</span></span></code></pre></div>
<p>Quite a difference in time! It is examples like this that lead to all the talk around why
R is slow at looping. In general I agree that if there is an obvious vectorized/base
solution (in this case simply using ifelse) use that. That being said, it isn’t always
obvious what the faster solution would be. ChatGPT or other AI programs could be helpful
in suggesting solutions.</p>
<p>In short, if an obvious vector or primitive solution exists, use that. If those aren’t
clear and you need to use a loop, don’t be afraid to use one. There are plenty of
examples where a vectorized solution exists for a loop, but it may be difficult to code
and understand. Personally, I think it is possible to go too far down the vectorized
path. Do it when it makes sense, otherwise take advantage of the for loop! You can
always try and speed things up after you have got your code working the first time.</p>
</div>
<div id="functions" class="section level3" number="4.12.2">
<h3>
<span class="header-section-number">4.12.2</span> Functions<a class="anchor" aria-label="anchor" href="#functions"><i class="fas fa-link"></i></a>
</h3>
<p>At this point we should be pretty well versed at using functions. They have a name and some arguments, and they
do something. Some return a value, some don’t. In short they form the basic structure of R. One of the cool
things about R (and programming in general), is that we are not stuck with the functions provided to us. We can
and should develop our own, as we often want to do things repeatedly, and in slightly different contexts.
Creating a function to deal with this fact helps us a great deal because we do not have to repeat ourselves, we
can just use what we have already written. Creating a function is really easy. We use the function() function.
It has the basic structure of:</p>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">function_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">arguments</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">codeGoesHere</span></span>
<span>  <span class="va">useArgumentsAsNeeded</span></span>
<span><span class="op">}</span> <span class="co">#ends function</span></span>
<span></span>
<span><span class="co">## So a real example with no arguments might look like:</span></span>
<span></span>
<span><span class="va">say_hi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Hello, World!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">say_hi</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Hello, World!"</code></pre>
<p>Well that’s nice. Not really useful, but shows the main components, function(), and the {} which are
really the only new things.</p>
<p>It would be a bit better if it were more flexible. We can do that because we can specify our own arguments<br>
to use within the body of the function. For example,</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">print_twice</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">my_text</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">print_twice</span><span class="op">(</span><span class="st">"Hello, World!"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Hello, World!"
## [1] "Hello, World!"</code></pre>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print_twice</span><span class="op">(</span><span class="st">"Hola, mundo"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Hola, mundo"
## [1] "Hola, mundo"</code></pre>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">print_twice</span><span class="op">(</span><span class="st">"Howdy, Texas"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Howdy, Texas"
## [1] "Howdy, Texas"</code></pre>
<p>Functions are most useful when we want to repeat a general procedure with different specifics each time. Since
we have been working most recently with creating plots, I could imagine us wanting to create a plot with a similar
layout, but with different source data and then save that plot to a file, all with a single function call. That
might look like:</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getPlot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">myDat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">x</span>, Y <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="co">#creating at dataframe</span></span>
<span>  <span class="va">myP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">myDat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">file</span>, plot <span class="op">=</span> <span class="va">myP</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">myP</span><span class="op">)</span> <span class="co"># to get the plot out of the function</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># call the function using siteDF</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu">getPlot</span><span class="op">(</span><span class="va">siteDF</span><span class="op">$</span><span class="va">flowX</span>, <span class="va">siteDF</span><span class="op">$</span><span class="va">flowY</span>, <span class="st">"flowPlot.png"</span><span class="op">)</span></span></code></pre></div>
<p>Nice… a function that does something useful</p>
<p>return()</p>
<p>The last control structure we are going to talk about is return(). All return() does is provide a result
from a function and terminates the function. You may be asking yourself, didn’t we terminate and get a value
from the functions we just created? We did, and return() is not mandatory for R functions as they will return
the last calculation. Some people argue that using return() is good practice because it allows us to be more
explicit. Others argue that concise is beautiful and that it’s not hard to see what is being implicitly returned.
Think about it for yourself as you learn more R. To see how return() can be used, let’s take a look at the
odd_even() and sum_vec() functions from before and make simple changes to take advantage of return().</p>
<p>First, oddEven().</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oddEven</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">num</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="st">"EVEN"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="st">"ODD"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>now, sumVec()</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sumVec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">vec</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="va">j</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="exporting-data" class="section level2" number="4.13">
<h2>
<span class="header-section-number">4.13</span> Exporting data<a class="anchor" aria-label="anchor" href="#exporting-data"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s say we want to send the wide version of our <code>sb_by_plot</code> data.frame to a colleague who doesn’t use R. In this case, we might want to save it as a CSV file.</p>
<p>First, we might want to modify the names of the columns, since right now they are bare numbers, which aren’t very informative. Luckily, <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> has an argument <code>names_prefix</code> which will allow us to add “plot_” to the start of each column.</p>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_by_plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">plot_id</span>, values_from <span class="op">=</span> <span class="va">mean_weight</span>,</span>
<span>              names_prefix <span class="op">=</span> <span class="st">"plot_"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 18 × 25
## # Groups:   species_id [18]
##    species_id plot_3 plot_21 plot_1 plot_2 plot_4 plot_5 plot_6 plot_7 plot_8
##    &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 BA           8       6.5   NA     NA     NA      NA    NA      NA    NA   
##  2 DM          41.2    41.5   42.7   42.6   41.9    42.6  42.1    43.2  43.4 
##  3 DO          42.7    NA     50.1   50.3   46.8    50.4  49.0    52    49.2 
##  4 DS         128.     NA    129.   125.   118.    111.  114.    126.  128.  
##  5 NL         171.    136.   154.   171.   164.    192.  176.    170.  134.  
##  6 OL          32.1    28.6   35.5   34     33.0    32.6  31.8    NA    30.3 
##  7 OT          24.1    24.1   23.7   24.9   26.5    23.6  23.5    22    24.1 
##  8 OX          22      NA     NA     22     NA      20    NA      NA    NA   
##  9 PE          22.7    19.6   21.6   22.0   NA      21    21.6    22.8  19.4 
## 10 PF           7.12    7.23   6.57   6.89   6.75    7.5   7.54    7     6.78
## 11 PH          28      31     NA     NA     NA      29    NA      NA    NA   
## 12 PM          20.1    23.6   23.7   23.9   NA      23.7  22.3    23.4  23   
## 13 PP          17.1    13.6   14.3   16.4   14.8    19.8  16.8    NA    13.9 
## 14 RF          14.8    17     NA     16     NA      14    12.1    13    NA   
## 15 RM          10.3     9.89  10.9   10.6   10.4    10.8  10.6    10.7   9   
## 16 SF          NA      49     NA     NA     NA      NA    NA      NA    NA   
## 17 SH          76.0    79.9   NA     88     NA      82.7  NA      NA    NA   
## 18 SS          NA      NA     NA     NA     NA      NA    NA      NA    NA   
## # ℹ 15 more variables: plot_9 &lt;dbl&gt;, plot_10 &lt;dbl&gt;, plot_11 &lt;dbl&gt;,
## #   plot_12 &lt;dbl&gt;, plot_13 &lt;dbl&gt;, plot_14 &lt;dbl&gt;, plot_15 &lt;dbl&gt;, plot_16 &lt;dbl&gt;,
## #   plot_17 &lt;dbl&gt;, plot_18 &lt;dbl&gt;, plot_19 &lt;dbl&gt;, plot_20 &lt;dbl&gt;, plot_22 &lt;dbl&gt;,
## #   plot_23 &lt;dbl&gt;, plot_24 &lt;dbl&gt;</code></pre>
<p>That looks better! Let’s save this data.frame as a new object.</p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_sp</span> <span class="op">&lt;-</span> <span class="va">sp_by_plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">plot_id</span>, values_from <span class="op">=</span> <span class="va">mean_weight</span>,</span>
<span>              names_prefix <span class="op">=</span> <span class="st">"plot_"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys_sp</span></span></code></pre></div>
<pre><code>## # A tibble: 18 × 25
## # Groups:   species_id [18]
##    species_id plot_3 plot_21 plot_1 plot_2 plot_4 plot_5 plot_6 plot_7 plot_8
##    &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 BA           8       6.5   NA     NA     NA      NA    NA      NA    NA   
##  2 DM          41.2    41.5   42.7   42.6   41.9    42.6  42.1    43.2  43.4 
##  3 DO          42.7    NA     50.1   50.3   46.8    50.4  49.0    52    49.2 
##  4 DS         128.     NA    129.   125.   118.    111.  114.    126.  128.  
##  5 NL         171.    136.   154.   171.   164.    192.  176.    170.  134.  
##  6 OL          32.1    28.6   35.5   34     33.0    32.6  31.8    NA    30.3 
##  7 OT          24.1    24.1   23.7   24.9   26.5    23.6  23.5    22    24.1 
##  8 OX          22      NA     NA     22     NA      20    NA      NA    NA   
##  9 PE          22.7    19.6   21.6   22.0   NA      21    21.6    22.8  19.4 
## 10 PF           7.12    7.23   6.57   6.89   6.75    7.5   7.54    7     6.78
## 11 PH          28      31     NA     NA     NA      29    NA      NA    NA   
## 12 PM          20.1    23.6   23.7   23.9   NA      23.7  22.3    23.4  23   
## 13 PP          17.1    13.6   14.3   16.4   14.8    19.8  16.8    NA    13.9 
## 14 RF          14.8    17     NA     16     NA      14    12.1    13    NA   
## 15 RM          10.3     9.89  10.9   10.6   10.4    10.8  10.6    10.7   9   
## 16 SF          NA      49     NA     NA     NA      NA    NA      NA    NA   
## 17 SH          76.0    79.9   NA     88     NA      82.7  NA      NA    NA   
## 18 SS          NA      NA     NA     NA     NA      NA    NA      NA    NA   
## # ℹ 15 more variables: plot_9 &lt;dbl&gt;, plot_10 &lt;dbl&gt;, plot_11 &lt;dbl&gt;,
## #   plot_12 &lt;dbl&gt;, plot_13 &lt;dbl&gt;, plot_14 &lt;dbl&gt;, plot_15 &lt;dbl&gt;, plot_16 &lt;dbl&gt;,
## #   plot_17 &lt;dbl&gt;, plot_18 &lt;dbl&gt;, plot_19 &lt;dbl&gt;, plot_20 &lt;dbl&gt;, plot_22 &lt;dbl&gt;,
## #   plot_23 &lt;dbl&gt;, plot_24 &lt;dbl&gt;</code></pre>
<p>Now we can save this data.frame to a CSV using the <code><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv()</a></code> function from the <code>readr</code> package. The first argument is the name of the data.frame, and the second is the path to the new file we want to create, including the file extension <code>.csv</code>.</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">surveys_sp</span>, <span class="st">"data/surveys_meanweight_species_plot.csv"</span><span class="op">)</span></span></code></pre></div>
<p>If we go look into our <code>data/cleaned_data</code> folder, we will see this new CSV file.</p>
</div>
<div id="summary-1" class="section level2" number="4.14">
<h2>
<span class="header-section-number">4.14</span> Summary<a class="anchor" aria-label="anchor" href="#summary-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to subset rows and <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to subset columns</li>
<li>build up pipelines one step at a time before assigning the result</li>
<li>it is often best to keep components of dates separate until needed, then use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to make a date column</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> can be used with <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> to collapse rows or <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to keep the same number of rows</li>
<li>
<code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> are powerful for reshaping data, but you should plan out how to use them thoughtfully</li>
</ul>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="exploring-and-understanding-data.html"><span class="header-section-number">3</span> Exploring and understanding data</a></div>
<div class="next"><a href="conceptual-ecological-models.html"><span class="header-section-number">5</span> Conceptual Ecological Models</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#manipulating-tabular-data"><span class="header-section-number">4</span> Manipulating Tabular Data</a></li>
<li><a class="nav-link" href="#learning-objectives-4"><span class="header-section-number">4.1</span> Learning Objectives</a></li>
<li><a class="nav-link" href="#importing-data"><span class="header-section-number">4.2</span> Importing data</a></li>
<li><a class="nav-link" href="#manipulating-data"><span class="header-section-number">4.3</span> Manipulating data</a></li>
<li><a class="nav-link" href="#challenge-1-filtering-and-selecting"><span class="header-section-number">4.4</span> Challenge 1: Filtering and selecting</a></li>
<li><a class="nav-link" href="#the-pipe"><span class="header-section-number">4.5</span> The pipe: %&gt;%</a></li>
<li><a class="nav-link" href="#challenge-2-using-pipes"><span class="header-section-number">4.6</span> Challenge 2: Using pipes</a></li>
<li><a class="nav-link" href="#making-new-columns-with-mutate"><span class="header-section-number">4.7</span> Making new columns with mutate()</a></li>
<li><a class="nav-link" href="#challenge-3-plotting-date"><span class="header-section-number">4.8</span> Challenge 3: Plotting date</a></li>
<li><a class="nav-link" href="#the-split-apply-combine-approach"><span class="header-section-number">4.9</span> The split-apply-combine approach</a></li>
<li><a class="nav-link" href="#challenge-4-making-a-time-series"><span class="header-section-number">4.10</span> Challenge 4: Making a time series</a></li>
<li><a class="nav-link" href="#reshaping-data-with-tidyr"><span class="header-section-number">4.11</span> Reshaping data with tidyr</a></li>
<li>
<a class="nav-link" href="#other-key-data-tools"><span class="header-section-number">4.12</span> Other key data tools</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#for-loops"><span class="header-section-number">4.12.1</span> For-loops</a></li>
<li><a class="nav-link" href="#functions"><span class="header-section-number">4.12.2</span> Functions</a></li>
</ul>
</li>
<li><a class="nav-link" href="#exporting-data"><span class="header-section-number">4.13</span> Exporting data</a></li>
<li><a class="nav-link" href="#summary-1"><span class="header-section-number">4.14</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Using R for ecological modeling in USACE</strong>" was written by Ed Stowe. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
