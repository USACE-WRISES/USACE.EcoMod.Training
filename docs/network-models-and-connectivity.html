<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>15 Network Models and Connectivity | Using R for ecological modeling in USACE</title>
<meta name="author" content="Ed Stowe">
<meta name="generator" content="bookdown 0.42 with bs4_book()">
<meta property="og:title" content="15 Network Models and Connectivity | Using R for ecological modeling in USACE">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="15 Network Models and Connectivity | Using R for ecological modeling in USACE">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="This module will teach you how to calculate upstream habitat benefits associated with alternative dam passage scenario in R using a USACE-created network model. Authors: Kyle McKay (writing,...">
<meta property="og:description" content="This module will teach you how to calculate upstream habitat benefits associated with alternative dam passage scenario in R using a USACE-created network model. Authors: Kyle McKay (writing,...">
<meta name="twitter:description" content="This module will teach you how to calculate upstream habitat benefits associated with alternative dam passage scenario in R using a USACE-created network model. Authors: Kyle McKay (writing,...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Using R for ecological modeling in USACE</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Using R for ecological modeling in USACE restoration planning</a></li>
<li><a class="" href="required-set-up-for-the-course.html">Required set-up for the course</a></li>
<li class="book-part">Basic Training on R and RStudio</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="data-visualization-with-ggplot2.html"><span class="header-section-number">2</span> Data Visualization with ggplot2</a></li>
<li><a class="" href="exploring-and-understanding-data.html"><span class="header-section-number">3</span> Exploring and understanding data</a></li>
<li><a class="" href="manipulating-tabular-data.html"><span class="header-section-number">4</span> Manipulating Tabular Data</a></li>
<li class="book-part">Ecological Modeling</li>
<li><a class="" href="conceptual-ecological-models.html"><span class="header-section-number">5</span> Conceptual Ecological Models</a></li>
<li class="book-part">Habitat Models</li>
<li><a class="" href="background-on-habitat-models-in-usace.html"><span class="header-section-number">6</span> Background on habitat models in USACE</a></li>
<li><a class="" href="habitat-suitability-index-models-with-ecorest.html"><span class="header-section-number">7</span> Habitat Suitability Index models with ecorest</a></li>
<li><a class="" href="ecorest-web-app.html"><span class="header-section-number">8</span> Ecorest Web App</a></li>
<li><a class="" href="sensitivity-and-uncertainty-analysis-for-habitat-suitability-index-hsi-models.html"><span class="header-section-number">9</span> Sensitivity and uncertainty analysis for habitat suitability index (HSI) models</a></li>
<li><a class="" href="spatial-habitat-models.html"><span class="header-section-number">10</span> Spatial Habitat Models</a></li>
<li class="book-part">Linear Models for informing planning HSIs</li>
<li><a class="" href="linear-models.html"><span class="header-section-number">11</span> Linear Models</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">12</span> Generalized Linear Models</a></li>
<li class="book-part">Machine Learning</li>
<li><a class="" href="random-forest.html"><span class="header-section-number">13</span> Random Forest</a></li>
<li class="book-part">Other Modeling Approaches</li>
<li><a class="" href="population-modeling.html"><span class="header-section-number">14</span> Population Modeling</a></li>
<li><a class="active" href="network-models-and-connectivity.html"><span class="header-section-number">15</span> Network Models and Connectivity</a></li>
<li><a class="" href="agent-based-models.html"><span class="header-section-number">16</span> Agent-based Models</a></li>
<li class="book-part">Models and decision-making</li>
<li><a class="" href="decision-support.html"><span class="header-section-number">17</span> Decision Support</a></li>
<li><a class="" href="annualizing-benefits-and-costs-with-ecorest-and-engrecon.html"><span class="header-section-number">18</span> Annualizing benefits and costs with ecorest and EngrEcon</a></li>
<li><a class="" href="ceica-chapter.html"><span class="header-section-number">19</span> Cost-Effectiveness and Incremental Cost Analysis (CEICA) with ecorest</a></li>
<li class="book-part">Other R applications</li>
<li><a class="" href="r-for-gis.html"><span class="header-section-number">20</span> R for GIS</a></li>
<li class="book-part">Environmental data sources</li>
<li><a class="" href="using-r-for-data-access.html"><span class="header-section-number">21</span> Using R for data access</a></li>
<li><a class="" href="usgs-gage-data-using-the-dataretrieval-package.html"><span class="header-section-number">22</span> USGS gage data using the dataRetrieval package</a></li>
<li><a class="" href="national-hydrography-dataset.html"><span class="header-section-number">23</span> National Hydrography Dataset</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="network-models-and-connectivity" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> Network Models and Connectivity<a class="anchor" aria-label="anchor" href="#network-models-and-connectivity"><i class="fas fa-link"></i></a>
</h1>
<p><strong>This module will teach you how to calculate upstream habitat benefits associated with alternative dam passage scenario in R using a USACE-created network model.</strong></p>
<p><em>Authors: Kyle McKay (writing, code), Ed Stowe (writing, editing); Background from WUCT materials (Readme &amp; RMD) on GitHub</em><br><em>Last update: 2026-01-09</em><br><em>Acknowledgements: </em></p>
<div id="overview-of-the-watershed-upstream-connectivity-tool" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Overview of the Watershed Upstream Connectivity Tool<a class="anchor" aria-label="anchor" href="#overview-of-the-watershed-upstream-connectivity-tool"><i class="fas fa-link"></i></a>
</h2>
<p>This module showcases a tool that quantifies benefits associated with the addition or removal of barriers that alter organism movement within a watershed (e.g., dam removal, culvert repair, fish ladder installation). The model focuses on upstream movement of migratory animals such as fish and applies to the watershed-scale.The algorithm is based on four primary components: habitat quantity upstream of a dam, habitat quality upstream of a dam, the passability of a structure for a given organism, and the shape/topology of the watershed. The tool combines these data to estimate quality-weighted, accessible habitat at the watershed scale.</p>
</div>
<div id="background-2" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Background<a class="anchor" aria-label="anchor" href="#background-2"><i class="fas fa-link"></i></a>
</h2>
<p>Water resources and transportation infrastructure such as dams and culverts provide countless socio-economic benefits; however, this infrastructure can also disconnect the movement of organisms, sediment, and water through river ecosystems (Pringle 2001). Trade-offs associated with these competing costs and benefits occur globally, with applications in barrier addition (e.g., dam and road construction), reengineering (e.g., culvert repair, fish ladder installation), and removal (e.g., dam removal and aging infrastructure). Nationwide, millions of barriers inhibit the movement of aquatic organisms, and barrier removal and repair have emerged as key techniques for river restoration. As of 2016, over 1,200 dams have been removed nationwide (Bellmore et al. 2016) as well as countless road-stream crossings repaired to facilitate movement (Januchowski-Hartley et al. 2013).</p>
<p>Restoration practitioners require tools for informing barrier removal, repair, and retrofit decisions. An important application is the rapid selection of efficient sites for removal, given the large number of watershed barriers (i.e., Is barrier-A or barrier-B the priority for restoration?). Another application is the computation of restoration benefits at a particular site to compare the relative effects of alternative management actions (e.g., Is a fish ladder or dam removal preferrable?). Dozens of studies globally have examined these questions with different methods and techniques (O’Hanley and Tomberlin 2005, Neeson et al. 2015, McKay et al. 2016).</p>
<p>This module showcases a framework for prioritizing barriers or quantifying benefits of restoration actions at a watershed-scale. The purpose of this tool is to assess watershed scale habitat connectivity and quality for migratory organisms to inform restoration planning. The framework is adaptable to varying project timelines, scopes, and applications. The following issues are crucial to the <strong>scoping and application</strong> of this framework:</p>
<ul>
<li>The focus is on migratory organisms moving upstream through a watershed (e.g., salmon seeking access to breeding habitat). Downstream movement is not considered to be limiting in this model framework and is neglected, although it can be an important limiting factor for some species.<br>
</li>
<li>The framework focuses on quantifying the accessibility of habitat to a focal taxa, and habitat quantity and quality can be incorporated through multiple methods.<br>
</li>
<li>Overall, this modeling approach may be used to rapidly screen barriers for site selection or quantify benefits of alternative restoration actions at a site scale, often referred to as “barrier prioritization techniques”.<br>
</li>
<li>The framework can be used in the context of benefits of barrier removal for desired taxa or impacts of barrier removal relative to invasive species. In either case, watershed connectivity may be assessed following this procedure, but the interpretation of results may be different. For instance, a user may chose to maximize connectivity for desirable species while minimizing connectivity for invasive species.<br>
</li>
<li>Many barrier prioritization studies address multiple taxa in development of watershed priorities. The framework could be applied to multiple taxa separately (i.e., developing connectivity estimates for each taxa), and then an overall assessment of could be obtained using a combined metric (e.g., sum or average of connected habitat for all species).</li>
</ul>
</div>
<div id="case-study-bronx-river" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Case Study: Bronx River<a class="anchor" aria-label="anchor" href="#case-study-bronx-river"><i class="fas fa-link"></i></a>
</h2>
<p>This case study examines fish passage prioritization for the Hudson-Raritan Estuary (HRE) project led by the USACE New York District (NAN). Specifically, this application quantifies fish passage benefits associated with two sites in the Bronx River watershed, which were proposed in the 2017 Draft Feasibility Report (USACE 2017) and supported by the Comprehensive Restoration Plan (USACE 2016). Fish passage outputs are quantified in terms of “accessible habitat” using the Watershed-Scale Upstream Connectivity Toolkit (WUCT) with river herring as the focal taxa.</p>
<p>Three dams are of interest in the Bronx River system moving from downstream to upstream. First, the East 182nd Street Dam is the first barrier encountered, where a fish ladder (Alaskan Steep pass) has been constructed by partners including NYC Parks, the Bronx Borough, the Wildlife Conservation Society, the National Oceanic and Atmospheric Administration, the US Fish and Wildlife Service, New York State, and the National Fish and Wildlife Foundation (Lumbian and Larson 2015). Second, the Bronx Zoo Dam is the next structure, where USACE has proposed three restoration alternatives as part of this feasibility study (all including a fish ladder). Third, the Stone Mill Dam (aka. Snuff Mill Dam) is the next structure, where USACE has proposed three restoration alternatives as part of this feasibility study (one with a fish ladder + attractors, one with a fish ladder, and one without a fish ladder). A significant amount of habitat is accessible above the Stone Mill Dam, when considering both main steam and tributary habitats. The Bronx River has been shown to support river herring populations, where accessibility is not limiting (Larson and Sugar 2004), and the 182nd St Dam fish ladder has subsequently demonstrated that river herring will utilize technical fishways in this region.</p>
<p>The WUCT requires three general types of inputs, and the HRE parameterization is as follows (also shown in Table 3):</p>
<ul>
<li>
<em>Habitat Quantity</em> - For each barrier, an area of upstream habitat opened is used as the primary basis for habitat quantity. First, the length of upstream habitat was computed (i.e., the distance between the dam and the next upstream barrier) and included all tributary habitats that would be newly accessible. River width was estimated from aerial photos in Google Earth as the smallest observable width upstream of the structure (i.e., an extremely conservative estimate). To create an area-based metric , the length of river is multiplied by width.<br>
</li>
<li>
<em>Habitat Quality</em> - Habitat quality was predicted based on a watershed-scale, geospatial analysis of all upstream habitat as presented in McKay et al. (2017). The model included three metrics accounting for land use development pressure, water quality, and the proportion of the basin in conservation status.<br>
</li>
<li>
<em>Passability</em> - Local studies of fish passage rates (i.e., passability) are unavailable in the Bronx River. As such, passability was estimated based on studies elsewhere on the efficacy of technical fishways in general and for river herring specifically. Prior to restoration actions, all structures are assumed to have zero passage of river herring. Alewife studies in New England (Franklin et al. 2012) report high overall passage rates of 64-99% passage in the East River, Massachusetts with particularly high rates for technical steep passes of 94-97%. These values are in line with a meta-analysis of 65 published fish passage studies (Noonan et al. 2011), which indicated that fish passage efforts typically result in 42% fish passage on average across a variety of taxa. Based on the Massachusetts data, we used 80% passability for all fish ladders as a conservative estimate of passage efficiency. The 182nd Street Dam and Ladder were included in all analyses as part of the future without prokect condition. At Stone Mill Dam, Alternative-A includes fish attractors to increase utilization of the ladder, which were assumed to increase passability by 10% (i.e., to 88% total).</li>
</ul>
<p>The following script imports data, isolates the necessary input data, computes all permutations of restoration actions, and computes connectivity for each watershed-scale restoration plan. Table 4 presents the output of the WUCT in this application. The connectivity values represent a connectivity- and quality-weighted assessment of total habitat at the watershed scale.</p>
</div>
<div id="case-study-code" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Case study code<a class="anchor" aria-label="anchor" href="#case-study-code"><i class="fas fa-link"></i></a>
</h2>
<p>First we import Bronx River barrier and adjacency data. To maximize the ease of using this code, users should change the column names of their input data to match the column names in the example data frame.</p>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import data</span></span>
<span><span class="va">barrieralts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/WUCT_HREData_2018-07-18_BarrierAlts.csv"</span>, header<span class="op">=</span><span class="cn">TRUE</span>, dec<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/WUCT_HREData_2018-07-18_Adjacency.csv"</span>, header<span class="op">=</span><span class="cn">FALSE</span>, dec<span class="op">=</span><span class="st">"."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can view the import data as a table using the <code>knitr</code> package.</p>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">barrieralts</span>, caption<span class="op">=</span><span class="st">"Table 3. Input data for the WUCT to the Bronx River as described in the text. Each node specifies the existing condition (shown as Alt=0), and multiple restoration alternatives are also be specified for each node (shown as Alt&gt;0)."</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-85">Table 15.1: </span>Table 3. Input data for the WUCT to the Bronx River as described in the text. Each node specifies the existing condition (shown as Alt=0), and multiple restoration alternatives are also be specified for each node (shown as Alt&gt;0).</caption>
<thead><tr class="header">
<th align="left">BarrierID</th>
<th align="right">Alt</th>
<th align="right">Passability</th>
<th align="right">QuantityUpstream</th>
<th align="right">QualityUpstream</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">EHB00</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.01</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">182nd St</td>
<td align="right">0</td>
<td align="right">0.80</td>
<td align="right">1.80</td>
<td align="right">0.20</td>
</tr>
<tr class="odd">
<td align="left">BronxZoo</td>
<td align="right">0</td>
<td align="right">0.00</td>
<td align="right">3.96</td>
<td align="right">0.41</td>
</tr>
<tr class="even">
<td align="left">BronxZoo</td>
<td align="right">1</td>
<td align="right">0.80</td>
<td align="right">3.96</td>
<td align="right">0.41</td>
</tr>
<tr class="odd">
<td align="left">BronxZoo</td>
<td align="right">2</td>
<td align="right">0.80</td>
<td align="right">3.96</td>
<td align="right">0.41</td>
</tr>
<tr class="even">
<td align="left">BronxZoo</td>
<td align="right">3</td>
<td align="right">0.80</td>
<td align="right">3.96</td>
<td align="right">0.41</td>
</tr>
<tr class="odd">
<td align="left">StoneMill</td>
<td align="right">0</td>
<td align="right">0.00</td>
<td align="right">98.66</td>
<td align="right">0.33</td>
</tr>
<tr class="even">
<td align="left">StoneMill</td>
<td align="right">1</td>
<td align="right">0.88</td>
<td align="right">98.66</td>
<td align="right">0.33</td>
</tr>
<tr class="odd">
<td align="left">StoneMill</td>
<td align="right">2</td>
<td align="right">0.80</td>
<td align="right">98.66</td>
<td align="right">0.33</td>
</tr>
<tr class="even">
<td align="left">StoneMill</td>
<td align="right">3</td>
<td align="right">0.80</td>
<td align="right">98.66</td>
<td align="right">0.33</td>
</tr>
</tbody>
</table></div>
<p>Next we create <code>connectivity</code> function. The code to create this function can be used in other applications.</p>
<p>Next we need to create objects vectors of the names of the barriers, as well as the number of barriers.</p>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Isolate properties of the alternatives at each barrier</span></span>
<span><span class="va">bnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">barrieralts</span><span class="op">$</span><span class="va">BarrierID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nbar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">bnames</span><span class="op">)</span></span></code></pre></div>
<p>We then run a short for-loop calculates the number of alternative designs that focus on each barrier, and then we calculate the total number of alternatives.</p>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Compute the number of alternatives at each barrier</span></span>
<span><span class="va">nalts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nbar</span><span class="op">)</span><span class="op">{</span><span class="va">nalts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">barrieralts</span><span class="op">$</span><span class="va">BarrierID</span> <span class="op">==</span> <span class="va">bnames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="va">nalts.total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">nalts</span><span class="op">)</span> <span class="co">#Compute the total number of combinations of actions</span></span></code></pre></div>
<p>We see from the <code>nalts</code> and <code>nalts.total</code> objects that the number of alternatives for each barrier varies from one for the first two barriers and 4 for the next two, resulting in a total of 16 alternatives.</p>
<p>Next, we create a list which stores all alternatives at each site. This list stores the row number of each alternative from <code>barrieralts</code>.</p>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##########</span></span>
<span><span class="va">site.alts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Create an empty list to store the combinations of sites/alts</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nbar</span><span class="op">)</span><span class="op">{</span><span class="va">site.alts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">barrieralts</span><span class="op">$</span><span class="va">BarrierID</span> <span class="op">==</span> <span class="va">bnames</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>Our final data preparation step is to compute all combinations of alternatives and sites. We do this using the <code>expand.grid</code> function, which creates a data frame from all combinations of variables in our <code>site.alts</code> list Within the data frame, each column is a site/barrier and each row is a unique plan with a combination of sites and alternatives. This dataframe needs to be converted to a matrix for the analysis.</p>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sitealts.combos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">site.alts</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Convert this data frame to a matrix </span></span>
<span><span class="va">sitealts.combos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="va">sitealts.combos</span><span class="op">)</span></span></code></pre></div>
<p>We’re now ready to compute our change in connectivity for each alternative. We use a for-loop to access the relevant passability habitat values from our <code>barrieralts</code> data frame, and then using our <code>connectivity</code> function to calculate our connectivity metric.</p>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WC.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#Empty vector to store watershed connectivity for each plan</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nalts.total</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#Isolate the passability and habitat values to be used</span></span>
<span>  <span class="va">pass.temp</span> <span class="op">&lt;-</span> <span class="va">barrieralts</span><span class="op">$</span><span class="va">Passability</span><span class="op">[</span><span class="va">sitealts.combos</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hab.temp</span> <span class="op">&lt;-</span> <span class="va">barrieralts</span><span class="op">$</span><span class="va">QualityUpstream</span><span class="op">[</span><span class="va">sitealts.combos</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">barrieralts</span><span class="op">$</span><span class="va">QuantityUpstream</span><span class="op">[</span><span class="va">sitealts.combos</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">#Compute connectivity and store result</span></span>
<span>  <span class="va">WC.out</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">connectivity</span><span class="op">(</span><span class="va">nbar</span>,<span class="va">A</span>,<span class="va">pass.temp</span>,<span class="va">hab.temp</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Finally, we can make another table to view the connectivity indices associated with our different alternatives.</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##########</span></span>
<span><span class="co">#Send output from the example problem as a table</span></span>
<span><span class="va">WC.HRE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">nalts.total</span>,ncol<span class="op">=</span><span class="va">nbar</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nalts.total</span><span class="op">)</span><span class="op">{</span><span class="va">WC.HRE</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">barrieralts</span><span class="op">$</span><span class="va">Alt</span><span class="op">[</span><span class="va">sitealts.combos</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">]</span>,<span class="va">WC.out</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">WC.HRE</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Plan"</span>,<span class="va">bnames</span>,<span class="st">"Connectivity"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">WC.HRE</span>, caption<span class="op">=</span><span class="st">"Table 4. Alternatives analysis using the WUCT in the Bronx River Watershed. Competing restoration alternatives are shown as rows, and the alternative used in the plan is denoted by the number shown."</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-92">Table 15.2: </span>Table 4. Alternatives analysis using the WUCT in the Bronx River Watershed. Competing restoration alternatives are shown as rows, and the alternative used in the plan is denoted by the number shown.</caption>
<thead><tr class="header">
<th align="right">Plan</th>
<th align="right">EHB00</th>
<th align="right">182nd St</th>
<th align="right">BronxZoo</th>
<th align="right">StoneMill</th>
<th align="right">Connectivity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.298000</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1.337104</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1.337104</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1.337104</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.298000</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">19.673657</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">19.673657</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">19.673657</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0.298000</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">18.006698</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">18.006698</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">18.006698</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0.298000</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">18.006698</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">18.006698</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">18.006698</td>
</tr>
</tbody>
</table></div>
</div>
<div id="discussion" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> Discussion<a class="anchor" aria-label="anchor" href="#discussion"><i class="fas fa-link"></i></a>
</h2>
<p>Here we demonstrated a procedure for quantifying benefits or impacts to organisms of altering riverine barrieres. The model focuses on upstream movement of migratory organisms such as fish and operates at the watershed-scale. The algorithm is based on four primary components: habitat quantity upstream of a dam, habitat quality upstream of a dam, the passability of a structure for a given organism, and the shape/topology of the watershed. This algorithm combines these data to estimate quality-weighted, accessible habitat at the watershed scale.</p>
<p>This modeling framework has been applied to multiple USACE projects with varying input parameters and ecological contexts. A few notable <strong>limitations and assumptions</strong> include the following issues.</p>
<ul>
<li>Upstream only movement. The current model only incorporates movement upstream, which implicitly assumes downstream movement is not a limiting factor for the organism’s life cycle. However, downstream movement can be an important driver of ecological function (e.g., fish trapping in agricultural diversion ditches or fish mortality due to hydropower turbines). Other connectivity algorithms can incorporate bidirectional movement.</li>
<li>The WUCT is primarily applicable in the context of migratory fishes because of the focus on connectivity to the outlet of the system. Alternative connectivity algorithms exist for resident fishes (e.g., Cote et al. 2009).<br>
</li>
<li>Numerical limits. The basic WUCT algorithm and the example application are extremely flexible for large-scale examination of watershed priorities and benefits. However, numerical problem size increases rapidly with the number of barriers are alternatives. For instance, a watershed with 30 barriers considering only the presence or absence of the barriers could result in more than a billion combinations of actions. As such, care should be taken to limit problem size to the extent practicable.</li>
</ul>
</div>
<div id="summary-8" class="section level2" number="15.6">
<h2>
<span class="header-section-number">15.6</span> Summary<a class="anchor" aria-label="anchor" href="#summary-8"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>The WUCT is a simple, flexible framework for quantifying the connectivity of watersheds and potential improvements through restoration actions</li>
<li>The adaptability of the framework is a primary strength of the tool, although this flexibility could also leads to significant variation in its application.</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="population-modeling.html"><span class="header-section-number">14</span> Population Modeling</a></div>
<div class="next"><a href="agent-based-models.html"><span class="header-section-number">16</span> Agent-based Models</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#network-models-and-connectivity"><span class="header-section-number">15</span> Network Models and Connectivity</a></li>
<li><a class="nav-link" href="#overview-of-the-watershed-upstream-connectivity-tool"><span class="header-section-number">15.1</span> Overview of the Watershed Upstream Connectivity Tool</a></li>
<li><a class="nav-link" href="#background-2"><span class="header-section-number">15.2</span> Background</a></li>
<li><a class="nav-link" href="#case-study-bronx-river"><span class="header-section-number">15.3</span> Case Study: Bronx River</a></li>
<li><a class="nav-link" href="#case-study-code"><span class="header-section-number">15.4</span> Case study code</a></li>
<li><a class="nav-link" href="#discussion"><span class="header-section-number">15.5</span> Discussion</a></li>
<li><a class="nav-link" href="#summary-8"><span class="header-section-number">15.6</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Using R for ecological modeling in USACE</strong>" was written by Ed Stowe. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
